<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.1.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-综合设计" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/05/04/%E7%BB%BC%E5%90%88%E8%AE%BE%E8%AE%A1/" class="article-date">
  <time class="dt-published" datetime="2022-05-04T07:20:21.000Z" itemprop="datePublished">2022-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/05/04/%E7%BB%BC%E5%90%88%E8%AE%BE%E8%AE%A1/">综合设计</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h1><p>创建一个conda环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">conda info -e #查看当前系统有哪些python环境</span><br><span class="line"></span><br><span class="line">conda create -n tf-pose python=3.7.10</span><br><span class="line"></span><br><span class="line">activate tf-pose #激活环境</span><br></pre></td></tr></table></figure>

<p>需要的环境</p>
<ul>
<li>opencv4.5.0</li>
<li>libatlas-base-dev-3.10.3</li>
</ul>
<h1 id="准备数据集"><a href="#准备数据集" class="headerlink" title="准备数据集"></a>准备数据集</h1><p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3d9436b4cb66">https://www.jianshu.com/p/3d9436b4cb66</a></p>
<p>标注数据集：labelimg</p>
<p>使用的数据集：imagenet n04589890（100张）</p>
<p>ps:模型文件夹从train改为了train_my</p>
<h1 id="训练数据"><a href="#训练数据" class="headerlink" title="训练数据"></a>训练数据</h1><p>使用预训练模型：ssd-v2-oidv4（git：<a target="_blank" rel="noopener" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf1_detection_zoo.md%EF%BC%89">https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf1_detection_zoo.md）</a></p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0e5f9df4686a">https://www.jianshu.com/p/0e5f9df4686a</a></p>
<ol>
<li>在此目录下运行下面命令</li>
</ol>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210817124854046.png" alt="image-20210817124854046"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python object_detection/model_main.py --pipeline_config_path=training_my/ssdlite_mobilenet_v2_coco.config --model_dir=training_my --alsologtostderr</span><br></pre></td></tr></table></figure>

<ol>
<li>查看模型训练情况</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensorboard --logdir=training</span><br></pre></td></tr></table></figure>

<p><a href="http://kunpc:6006查看/">http://KUNPC:6006查看</a></p>
<h2 id="遇到问题："><a href="#遇到问题：" class="headerlink" title="遇到问题："></a>遇到问题：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">tensorflow.python.framework.errors_impl.UnknownError: 2 root error(s) found.</span><br><span class="line">  (0) Unknown: Failed to get convolution algorithm. This is probably because cuDNN failed to initialize, so try looking to see if a warning log message was printed above.</span><br><span class="line">         [[node FeatureExtractor/MobilenetV2/Conv/Conv2D (defined at E:\Anaconda3-\machinelearning\envs\tf-pose\lib\site-packages\tf_slim-1.1.0-py3.7.egg\tf_slim\layers\layers.py:1089) ]]</span><br><span class="line"></span><br><span class="line">         [[Loss/Cast_34/_7177]]</span><br><span class="line">  (1) Unknown: Failed to get convolution algorithm. This is probably because cuDNN failed to initialize, so try looking to see if a warning log message was printed above.</span><br><span class="line">         [[node FeatureExtractor/MobilenetV2/Conv/Conv2D (defined at E:\Anaconda3-\machinelearning\envs\tf-pose\lib\site-packages\tf_slim-1.1.0-py3.7.egg\tf_slim\layers\layers.py:1089) ]]</span><br><span class="line"></span><br><span class="line">0 successful operations.</span><br><span class="line">0 derived errors ignored.</span><br><span class="line"></span><br><span class="line">Errors may have originated from an input operation.</span><br><span class="line">Input Source operations connected to node FeatureExtractor/MobilenetV2/Conv/Conv2D:</span><br><span class="line"> FeatureExtractor/MobilenetV2/Conv/weights/read (defined at E:\Anaconda3-\machinelearning\envs\tf-pose\lib\site-packages\tf_slim-1.1.0-py3.7.egg\tf_slim\ops\variables.py:256)</span><br><span class="line"> FeatureExtractor/MobilenetV2/MobilenetV2/input (defined at D:\code\Tensorflow\useless\models\research\slim\nets\mobilenet\mobilenet.py:368)</span><br></pre></td></tr></table></figure>

<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#添加下面两行，</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">os.environ[&#x27;CUDA_VISIBLE_DEVICES&#x27;] = &#x27;/gpu:0&#x27;</span><br></pre></td></tr></table></figure>

<p>或者：可能是Tensorflow-gpu版本太高，我报错时为1.12，可以将其降为1.9.0<br>pip install tensorflow-gpu&#x3D;&#x3D;1.9.0或者conda install tensorflow-gpu&#x3D;&#x3D;1.9.0</p>
<p>Note：我不知道是不是同时需要将cpu版本的tensorflow也降下来，如果你还有问题，则继续执行</p>
<p>pip install tensorflow&#x3D;&#x3D;1.9.0或者conda install tensorflow&#x3D;&#x3D;1.9.0</p>
<p>不报错了，但速度慢的一匹，</p>
<h3 id="查看任务管理器：然而还是没有使用gpu加速，只是能运行了而已（gpu只占用了1-）"><a href="#查看任务管理器：然而还是没有使用gpu加速，只是能运行了而已（gpu只占用了1-）" class="headerlink" title="查看任务管理器：然而还是没有使用gpu加速，只是能运行了而已（gpu只占用了1%）"></a>查看任务管理器：然而还是没有使用gpu加速，只是能运行了而已（gpu只占用了1%）</h3><p>根据这篇文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/zlase/article/details/79261348">https://blog.csdn.net/zlase/article/details/79261348</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import numpy</span><br><span class="line">import tensorflow as tf</span><br><span class="line">a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name=&#x27;a&#x27;)</span><br><span class="line">b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name=&#x27;b&#x27;)</span><br><span class="line">c = tf.matmul(a, b)</span><br><span class="line">sess = tf.Session(config=tf.ConfigProto(log_device_placement=True))</span><br><span class="line">print(sess.run(c))</span><br></pre></td></tr></table></figure>

<p>查看出来确实是gpu在运行：</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210817155210209.png" alt="image-20210817155210209"></p>
<p>非常离谱，裂开了</p>
<p>然后发现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2021-08-17 16:11:44.539426: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library nvcuda.dll</span><br><span class="line">2021-08-17 16:11:44.582555: E tensorflow/stream_executor/cuda/cuda_driver.cc:318] failed call to cuInit: CUDA_ERROR_NO_DEVICE: no CUDA-capable device is detected</span><br></pre></td></tr></table></figure>

<p>问题应该出在下面这一行，一百度，全是说没有dll文件的，但是我没有报没有dll文件的错误，gg。</p>
<p>又继续找：找到一个国外老兄有一样的问题：</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/61483632/e-tensorflow-stream-executor-cuda-cuda-driver-cc351-failed-call-to-cuinit-cuda">https://stackoverflow.com/questions/61483632/e-tensorflow-stream-executor-cuda-cuda-driver-cc351-failed-call-to-cuinit-cuda</a></p>
<p>只有个人回答他版本对不上。</p>
<p>怀疑是cuda和cudnn和tensorflow-gpu1.14.0和GTX1650对应不上</p>
<p>查看cuda版本：<code>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.0</code>可见是v10.0</p>
<p>查看cudnn版本：<code>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.0\cudnn\include\cudnn.h</code>文件</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210817165746682.png" alt="image-20210817165746682"></p>
<p>发现是7.6.5版本的</p>
<p>查看N卡支持的cuda版本：（控制面板-系统信息）</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210817170126941.png" alt="image-20210817170126941"></p>
<p>发现我们需要的版本是11.1.114</p>
<p>cuda下载地址：</p>
<p><a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-toolkit-archive">https://developer.nvidia.com/cuda-toolkit-archive</a></p>
<p>就在要去下载的时候，突然想器上次看配置的时候这个版本应该就是10点几啊，然后发现网上的人1650用的都是10.1的cuda，看来跟这个没什么关系。</p>
<p>然后又百度到了这篇文章</p>
<p><a target="_blank" rel="noopener" href="https://bbs.csdn.net/topics/392851047">https://bbs.csdn.net/topics/392851047</a></p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210817172339074.png" alt="image-20210817172339074"></p>
<p>这位老哥的问题不能说和我是一模一样，只能说是十分相似。</p>
<p>然后根据这篇文章找到了另一篇文章：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45709671/article/details/107448136">https://blog.csdn.net/weixin_45709671/article/details/107448136</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/csdnfala/article/details/91358622">https://blog.csdn.net/csdnfala/article/details/91358622</a></p>
<h4 id="根据第二篇文章"><a href="#根据第二篇文章" class="headerlink" title="根据第二篇文章:"></a>根据第二篇文章:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import tensorflow as tf</span><br><span class="line">a = tf.constant(1)</span><br><span class="line">b = tf.constant(1)</span><br><span class="line">c = a + b</span><br><span class="line">sess = tf.Session(config =tf.ConfigProto(log_device_placement = True))</span><br><span class="line">print(sess.run(c))</span><br></pre></td></tr></table></figure>

<p>若正常应该输出2，并且在输出2之前有很长串的信息如算力(ability)、gpu的分配情况等等。</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210817172948282.png" alt="image-20210817172948282"></p>
<h4 id="根据第一篇文章"><a href="#根据第一篇文章" class="headerlink" title="根据第一篇文章"></a>根据第一篇文章</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">conda install cudatoolkit=10.1</span><br><span class="line">conda install cudnn=7.6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pip install -i https://mirrors.aliyun.com/pypi/simple/ tensorflow==2.1</span><br><span class="line">pip install -i https://mirrors.aliyun.com/pypi/simple/ tensorflow-gpu==2.1</span><br></pre></td></tr></table></figure>

<p>检验</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import tensorflow as tf</span><br><span class="line">print(tf.__version__)</span><br><span class="line"># 如果安装成功，则会输出2.1.0</span><br><span class="line"></span><br><span class="line">gpu_device_name = tf.test.gpu_device_name()</span><br><span class="line">print(gpu_device_name)</span><br><span class="line">print(tf.test.is_gpu_available())  #输出为True，则证明GPU版本的tensorflow安装成功</span><br><span class="line">#否则为CPU版本，若有需要GPU，可尝试重新安装</span><br><span class="line">#使用指令  pip install tensorflow-gpu==2.1 ，指定GPU版本</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210817175821175.png" alt="image-20210817175821175"></p>
<p>成功</p>
<p>再次运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python object_detection/model_main.py --pipeline_config_path=training_my/ssdlite_mobilenet_v2_coco.config --model_dir=training_my --alsologtostderr</span><br></pre></td></tr></table></figure>

<p>还是没什么软用。还有函数出错，还是得降回1.14.0，得先删除高版本和一些东西，具体删除什么报错了再找</p>
<h4 id="第二天："><a href="#第二天：" class="headerlink" title="第二天："></a>第二天：</h4><p>英伟达控制台查看gpu使用情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvidia-smi.exe -l 5  #五秒查一次</span><br></pre></td></tr></table></figure>

<p>这里发现其实英伟达的cuda版本分驱动版和软件版，驱动板就是英伟达面板里看的那个（能使用显卡的程序都需要驱动版），软件版就是跑机器学习的时候使用的</p>
<p>上面的命令查看到的cuda是驱动版，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc -V</span><br></pre></td></tr></table></figure>

<p>查看到的是软件版，一般来说</p>
<p>驱动版的版本号高于软件版的就没问题</p>
<h4 id="另辟蹊径："><a href="#另辟蹊径：" class="headerlink" title="另辟蹊径："></a>另辟蹊径：</h4><p>突然发现：github有TF1.0和2.0的版本，尝试使用tensorflow2.2和python3.6搭建一个新环境：（之前是1.14）</p>
<p><a target="_blank" rel="noopener" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2.md">https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2.md</a></p>
<ol>
<li>在code目录下新建一个objectdetection2的目录</li>
<li>克隆源码</li>
<li>使用虚拟环境ob，并安装tf2.2</li>
<li>按照命令执行tf2.setup.py</li>
<li>将之前的train_my文件下复制到项目目录下</li>
</ol>
<p>得到</p>
<p>gg，环境搞乱了，remake</p>
<h1 id="remake："><a href="#remake：" class="headerlink" title="remake："></a>remake：</h1><p>重新搭建tf-pose环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#删除原来的虚拟环境</span><br><span class="line">conda remove -n tf-pose --all</span><br><span class="line">#创建虚拟环境</span><br><span class="line">conda create -n tf-pose python=3.6</span><br><span class="line">#激活</span><br><span class="line">activate tf-pose</span><br><span class="line">#安装tensorflow-gpu</span><br><span class="line">conda install tensorflow-gpu==1.15.0</span><br><span class="line">#安装tf_slim</span><br><span class="line">pip install tf_slim</span><br><span class="line">#安装pycocotools</span><br><span class="line">pip install pycocotools</span><br><span class="line">#安装lvis</span><br><span class="line">pip install lvis</span><br><span class="line">#安装resnet</span><br><span class="line">pip install resnet</span><br></pre></td></tr></table></figure>

<p>报错：</p>
<p>from tensorflow.python.keras.applications import resnet50 as resnet<br>ImportError: cannot import name ‘resnet50’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#降级回1.14.0,必须得同时安装cpu和gpu版本，不然报错</span><br><span class="line">import tensorflow.compat.v1 as tf</span><br><span class="line">ModuleNotFoundError: No module named &#x27;tensorflow.compat&#x27;</span><br><span class="line"></span><br><span class="line">#安装scipy</span><br><span class="line">pip install scipy</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python object_detection/builders/model_builder_tf1_test.py</span><br></pre></td></tr></table></figure>

<p>成功：</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210818143913605.png" alt="image-20210818143913605"></p>
<p>训练：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python object_detection/model_main.py --pipeline_config_path=training_my/ssdlite_mobilenet_v2_coco.config --model_dir=training_my --alsologtostderr</span><br></pre></td></tr></table></figure>

<p>外面的可以跑，但还是用的cpu，里面的报错:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2021-08-18 14:53:00.892597: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2</span><br><span class="line">Windows fatal exception: access violation</span><br></pre></td></tr></table></figure>

<p>外面的没使用gpu：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2021-08-18 15:06:43.280716: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2</span><br><span class="line">2021-08-18 15:06:43.282694: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library nvcuda.dll</span><br><span class="line">2021-08-18 15:06:43.315183: E tensorflow/stream_executor/cuda/cuda_driver.cc:318] failed call to cuInit: CUDA_ERROR_NO_DEVICE: no CUDA-capable device is detected</span><br><span class="line">2021-08-18 15:06:43.321281: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:169] retrieving CUDA diagnostic information for host: LAPTOP-B9TRJB</span><br><span class="line">2021-08-18 15:06:43.321534: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:176] hostname: LAPTOP-B9TR</span><br></pre></td></tr></table></figure>

<p>回到解放前</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lscelory/article/details/83579062">https://blog.csdn.net/lscelory/article/details/83579062</a></p>
<p>这个博主说将CUDA_VISIBLE_DEVICES&#x3D;0添加到环境变量中去</p>
<p>然而并没有什么软用</p>
<p>这篇文章说使用legacy的train来训练</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34289454/article/details/89611294">https://blog.csdn.net/weixin_34289454/article/details/89611294</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python object_detection/legacy/train.py --pipeline_config_path=training_my/ssdlite_mobilenet_v2_coco.config --train_dir=training_my/train --alsologtostderr</span><br></pre></td></tr></table></figure>

<p>然而并没有什么软用，但是速度变快了一秒一百个step了</p>
<p>现在开始怀疑是不是代码里有什么指定使用cpu的片段</p>
<h2 id="搭建ob环境"><a href="#搭建ob环境" class="headerlink" title="搭建ob环境"></a>搭建ob环境</h2><p>在这之前先把另一个环境ob搭好，和tf-pose除了tensorflow版本不一样和没有cpu版本的之外全一样</p>
<p>但是报错：</p>
<p>ERROR: pip’s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.<br>tensorflow-gpu 2.2.0 requires gast&#x3D;&#x3D;0.3.3, but you have gast 0.4.0 which is incompatible.<br>tensorflow-gpu 2.2.0 requires h5py&lt;2.11.0,&gt;&#x3D;2.10.0, but you have h5py 3.1.0 which is incompatible.<br>tensorflow-gpu 2.2.0 requires tensorboard&lt;2.3.0,&gt;&#x3D;2.2.0, but you have tensorboard 2.6.0 which is incompatible.</p>
<p>先一一装好</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install  gast==0.3.3</span><br><span class="line">pip install h5py==2.10.0</span><br><span class="line">pip install tensorboard==2.2.0</span><br></pre></td></tr></table></figure>

<p>环境装好了，开始测试项目：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Compile protos.生成proto文件，一个py文件对应生成一个proto文件</span><br><span class="line">protoc object_detection/protos/*.proto --python_out=.</span><br><span class="line"># Install TensorFlow Object Detection API.</span><br><span class="line">cp object_detection/packages/tf2/setup.py .</span><br><span class="line">python -m pip install --use-feature=2020-resolver .</span><br><span class="line">#发现这一步会将上一步安装的三个版本的插件又改回去，还会安装tensorflow2.6.0，然后运行下一步报错：没有resnet50，gg</span><br><span class="line"></span><br><span class="line"># Test the installation.</span><br><span class="line">python object_detection/builders/model_builder_tf2_test.py</span><br></pre></td></tr></table></figure>

<p>于是重装上面三个插件（版本），卸载tensorflow2.6，安装tensorflow2.2（conda库里没有就用pip装）</p>
<p>只有gpu没有cpu的会报错： No module named ‘tensorflow.compat’</p>
<p>再次报错： cannot import name ‘resnet50’，gg</p>
<p>然后发现是环境变量没换</p>
<p>这里我用两个环境变量：</p>
<p>PATH里</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210818212837624.png" alt="image-20210818212837624"></p>
<p>PYTHONPATH里：</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210818212917529.png" alt="image-20210818212917529"></p>
<p>用哪个把那个放上面就行了</p>
<p>运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python object_detection/builders/model_builder_tf2_test.py</span><br></pre></td></tr></table></figure>

<p>报错：</p>
<p>from official.vision.image_classification.efficientnet import efficientnet_model<br>ModuleNotFoundError: No module named ‘official’</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/63460911/why-do-i-keep-on-getting-no-module-named-official-error">https://stackoverflow.com/questions/63460911/why-do-i-keep-on-getting-no-module-named-official-error</a></p>
<p>这篇文章说：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(ob) D:\code\object detection2.0&gt;cd models</span><br><span class="line"></span><br><span class="line">(ob) D:\code\object detection2.0\models&gt;cd research</span><br><span class="line"></span><br><span class="line">(ob) D:\code\object detection2.0\models\research&gt;pip install tf-models-official</span><br></pre></td></tr></table></figure>

<p>然后又给我换成2.6.0了</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210818223551339.png" alt="image-20210818223551339"></p>
<p>运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python object_detection/builders/model_builder_tf2_test.py</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210818223716643.png" alt="image-20210818223716643"></p>
<p>再次怀疑是cuda版本的问题</p>
<p>去下载cuda11.1.0和对应版本的cudnn</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1qh411Y7uX?from=search&amp;seid=4131547032775557021">https://www.bilibili.com/video/BV1qh411Y7uX?from=search&amp;seid=4131547032775557021</a></p>
<p>安装cudatoolkit和cudnn</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210818230115971.png" alt="image-20210818230115971"></p>
<p>再次运行报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">: F .\tensorflow/core/kernels/random_op_gpu.h:246] Non-OK-status: GpuLaunchKernel(FillPhiloxRandomKernelLaunch&lt;Distribution&gt;, num_blocks, block_size, 0, d.stream(), key, counter, gen, data, size, dist) status:</span><br><span class="line"> Internal: invalid configuration argument</span><br><span class="line">Fatal Python error: Aborted</span><br></pre></td></tr></table></figure>

<p>在py文件中添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">os.environ[&quot;CUDA_DEVICE_ORDER&quot;] = &quot;PCI_BUS_ID&quot;</span><br><span class="line">os.environ[&quot;CUDA_VISIBLE_DEVICES&quot;] = &quot;5&quot;</span><br><span class="line">gpu_options = tf.GPUOptions(per_process_gpu_memory_fraction=0.83)</span><br><span class="line">sess = tf.Session(config=tf.ConfigProto(gpu_options=gpu_options))</span><br></pre></td></tr></table></figure>

<p>解决</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210821123855565.png" alt="image-20210821123855565"></p>
<h2 id="版本不符"><a href="#版本不符" class="headerlink" title="版本不符"></a>版本不符</h2><p>百度说tensorflow和cuda版本不符：</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210818235538040.png" alt="image-20210818235538040"></p>
<p>于是 下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install tensorflow-gpu==2.4</span><br></pre></td></tr></table></figure>

<p>但是又卸载了一些2.6的东西</p>
<p>先不运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp object_detection/packages/tf2/setup.py .</span><br><span class="line">python -m pip install --use-feature=2020-resolver .</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python object_detection/builders/model_builder_tf2_test.py</span><br></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> from tensorflow.python.keras.layers.normalization import LayerNormalization</span><br><span class="line">ImportError: cannot import name &#x27;LayerNormalization&#x27;</span><br></pre></td></tr></table></figure>

<p>再运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp object_detection/packages/tf2/setup.py .</span><br><span class="line">python -m pip install --use-feature=2020-resolver .</span><br></pre></td></tr></table></figure>

<p>还是报一样的错</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/68080345/importerror-cannot-import-name-layernormalization-from-tensorflow-python-ker">https://stackoverflow.com/questions/68080345/importerror-cannot-import-name-layernormalization-from-tensorflow-python-ker</a></p>
<p>这篇文章说将tensorflow降级到2.3.0，但是这样就不符合cuda版本了</p>
<p>最后删除2.6.0的cpu，安装2.4的cpu版</p>
<p>报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> Non-OK-status: GpuLaunchKernel(FillPhiloxRandomKernelLaunch&lt;Distribution&gt;, num_blocks, block_size, 0, d.stream(), key, counter, gen, data, size, dist) status:</span><br><span class="line"> Internal: invalid configuration argument</span><br><span class="line">Fatal Python error: Aborted</span><br></pre></td></tr></table></figure>

<p>算了还是用网上的测试代码吧，tensorflow2.0版本测试gpu代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import tensorflow.compat.v1 as tf</span><br><span class="line">tf.compat.v1.disable_eager_execution()</span><br><span class="line">a = tf.constant(1)</span><br><span class="line">b = tf.constant(1)</span><br><span class="line">c = a + b</span><br><span class="line">sess = tf.Session(config =tf.ConfigProto(log_device_placement = True))</span><br><span class="line">print(sess.run(c))</span><br></pre></td></tr></table></figure>

<p>成功输出：2</p>
<p>使用tf2来训练：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python object_detection/model_main_tf2.py --pipeline_config_path=training_my/ssdlite_mobilenet_v2_coco.config --model_dir=training_my --alsologtostderr</span><br></pre></td></tr></table></figure>

<p>报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   compat.path_to_str(self.__name), 1024 * 512)</span><br><span class="line">UnicodeDecodeError: &#x27;utf-8&#x27; codec can&#x27;t decode byte 0xd5 in position 94: invalid continuation byte</span><br></pre></td></tr></table></figure>

<p>怀疑是tfrecord文件编码格式不对，找到了另外一个人生成tfrecord文件的代码</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zong596568821xp/article/details/82015126">https://blog.csdn.net/zong596568821xp/article/details/82015126</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python generate_tfrecord.py --csv_input=../train.csv --output_path=../data/train.record</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python generate_tfrecord.py --csv_input=../test.csv --output_path=../data/test.record</span><br></pre></td></tr></table></figure>

<p>结果报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> File &quot;E:\Anaconda3-\machinelearning\envs\ob\lib\site-packages\tensorflow\python\lib\io\file_io.py&quot;, line 80, in _preread_check</span><br><span class="line">    compat.path_to_str(self.__name), 1024 * 512)</span><br><span class="line">UnicodeDecodeError: &#x27;utf-8&#x27; codec can&#x27;t decode byte 0xd5 in position 57: invalid continuation byte</span><br></pre></td></tr></table></figure>

<p>和上面一样</p>
<p>执行setup.py，装回2.6</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install --use-feature=2020-resolver .</span><br><span class="line"></span><br><span class="line">python object_detection/model_main_tf2.py --pipeline_config_path=training_my/ssdlite_mobilenet_v2_coco.config --model_dir=training_my --alsologtostderr</span><br></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> File &quot;E:\Anaconda3-\machinelearning\envs\ob\lib\site-packages\tensorflow\python\lib\io\file_io.py&quot;, line 80, in _preread_check</span><br><span class="line">    compat.path_to_str(self.__name), 1024 * 512)</span><br><span class="line">UnicodeDecodeError: &#x27;utf-8&#x27; codec can&#x27;t decode byte 0xd5 in position 94: invalid continuation byte</span><br></pre></td></tr></table></figure>

<p>发现record文件是ansi编码</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210821111959296.png" alt="image-20210821111959296"></p>
<p>我敲</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210821142435913.png" alt="image-20210821142435913"></p>
<p>马上改：但是window不让改，改完马上又便会utf-8，知乎上说ansi不是一种编码格式，win10上的ansi就是utf-8。</p>
<p>将training_my文件夹改成training</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python object_detection/model_main_tf2.py --pipeline_config_path=training/ssdlite_mobilenet_v2_coco.config --model_dir=training --alsologtostderr</span><br><span class="line">python object_detection/model_main_tf2.py --pipeline_config_path=training/ssdlite_mobilenet_v2_coco.config --model_dir=training/model --checkpoint_dir=traing/checkpoint --alsologtostderr</span><br></pre></td></tr></table></figure>

<p>这位老哥的问题和我一样</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/67426245/unicodedecodeerror-utf-8-codec-cant-decode-byte-0xd5-in-position-93-invalid">https://stackoverflow.com/questions/67426245/unicodedecodeerror-utf-8-codec-cant-decode-byte-0xd5-in-position-93-invalid</a></p>
<p>又找到了一个倒霉蛋：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40493501/article/details/89787144%EF%BC%88%E6%97%A0%E8%A7%A3%E5%86%B3%EF%BC%89">https://blog.csdn.net/weixin_40493501/article/details/89787144（无解决）</a></p>
<h1 id="再次remake"><a href="#再次remake" class="headerlink" title="再次remake"></a>再次remake</h1><p>跟着这个视屏来做：</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1tW411T7ei?p=2">https://www.bilibili.com/video/BV1tW411T7ei?p=2</a></p>
<ol>
<li><p>&#96;&#96;&#96;<br>#安装tf1.14.0</p>
<p>(tf&#x3D;pose) D:\code\ob3.0&gt;pip install tensorflow&#x3D;&#x3D;1.14.0</p>
<p>#先不安装gpu</p>
<p>#搭建环境<br>cp object_detection&#x2F;packages&#x2F;tf1&#x2F;setup.py .<br>python -m pip install –use-feature&#x3D;2020-resolver .</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">最终将train放在和research目录下，和object_detection同级：(报错)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> ‘Tensorflow’.format(feature_extractor_type))</p>
</li>
</ol>
<p>ValueError: ssd_mobilenet_v2 is not supported. See <code>model_builder.py</code> for features extractors compatible with different versions of Tensorflow</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">改模型不支持tensorflow2，</span><br><span class="line"></span><br><span class="line"># 重新搞tensorflow1.x</span><br><span class="line"></span><br><span class="line">activate tf-pose</span><br><span class="line"></span><br><span class="line">我们换回目标检测项目，环境变量也换了，安装cuda10，</span><br><span class="line"></span><br><span class="line">cudnn：https://developer.nvidia.com/rdp/cudnn-archive#a-collapse765-10</span><br><span class="line"></span><br><span class="line">cuda：https://developer.nvidia.com/cuda-toolkit-archive</span><br><span class="line"></span><br><span class="line">cuda只安装这四个：</span><br><span class="line"></span><br><span class="line">![image-20210824115302952](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824115302952.png)</span><br><span class="line"></span><br><span class="line">![image-20210824115412219](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824115412219.png)</span><br><span class="line"></span><br><span class="line">现在好像不用下载cudnn了这里面点不进去</span><br><span class="line"></span><br><span class="line">直接就有cudnn文件夹，将其打开，把里面的三个文件夹复制到外面就行了：</span><br><span class="line"></span><br><span class="line">![image-20210824120626739](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824120626739.png)</span><br><span class="line"></span><br><span class="line">复制过去，完成</span><br><span class="line"></span><br><span class="line">![image-20210824120749298](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824120749298.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python object_detection&#x2F;model_main.py –pipeline_config_path&#x3D;.&#x2F;training_my&#x2F;ssdlite_mobilenet_v2_coco.config –model_dir&#x3D;.&#x2F;training_my –alsologtostderr</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">回到原来的问题：没有使用gpu</span><br><span class="line"></span><br><span class="line">![image-20210824121551465](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824121551465.png)</span><br><span class="line"></span><br><span class="line">安装tensorflow1.15后</span><br><span class="line"></span><br><span class="line">测试是否成功</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python object_detection&#x2F;builders&#x2F;model_builder_tf1_test.py<br>#报错：<br>ImportError: cannot import name ‘resnet50’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">安装会1.14，问题消失</span><br><span class="line"></span><br><span class="line">但是还是用的cpu</span><br><span class="line"></span><br><span class="line">![image-20210824131641749](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824131641749.png)</span><br><span class="line"></span><br><span class="line">发现问题：需要7.4的cudnn而我的是cudnn7.6：</span><br><span class="line">![image-20210824131739883](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824131739883.png)</span><br><span class="line"></span><br><span class="line">去下载cudnn7.4：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>nvidia-smi</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20210824132935567](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824132935567.png)</span><br><span class="line"></span><br><span class="line">最终将上面的改成下面的成功使用gpu了</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>import os</p>
<h1 id="os-environ-‘CUDA-VISIBLE-DEVICES’-x3D-‘-x2F-device-GPU-0’"><a href="#os-environ-‘CUDA-VISIBLE-DEVICES’-x3D-‘-x2F-device-GPU-0’" class="headerlink" title="os.environ[‘CUDA_VISIBLE_DEVICES’] &#x3D; ‘&#x2F;device:GPU:0’"></a>os.environ[‘CUDA_VISIBLE_DEVICES’] &#x3D; ‘&#x2F;device:GPU:0’</h1><p>os.environ[‘CUDA_VISIBLE_DEVICES’] &#x3D; “0”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">虽然任务管理器中没有使用，但是我相信联想电脑管家</span><br><span class="line"></span><br><span class="line">![image-20210824154807005](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824154807005.png)</span><br><span class="line"></span><br><span class="line">![image-20210824154752154](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824154752154.png)</span><br><span class="line"></span><br><span class="line">20%是因为：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>gpu_options &#x3D; tf.GPUOptions(per_process_gpu_memory_fraction&#x3D;0.2)#0.9表示可以使用GPU 90%的资源进行训练，可以任意修改</p>
<p>sess &#x3D; tf.Session(config&#x3D;tf.ConfigProto(gpu_options&#x3D;gpu_options))</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">改成0.7</span><br><span class="line"></span><br><span class="line">不能修改train_my为train文件夹</span><br><span class="line"></span><br><span class="line"># 测试：</span><br><span class="line"></span><br><span class="line">## 导出模型命令</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python object_detection&#x2F;export_inference_graph.py –input_type&#x3D;image_tensor –pipeline_config_path&#x3D;training_my&#x2F;ssdlite_mobilenet_v2_coco.config –trained_checkpoint_prefix&#x3D;training_my&#x2F;model.ckpt-9000 –output_directory&#x3D;window_inference_graph</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">使用select_images文件夹中的图片，在图片中随机选取十张来测验：</span><br><span class="line"></span><br><span class="line">![image-20210824183256102](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824183256102.png)</span><br><span class="line"></span><br><span class="line">运行test_my_model.py</span><br><span class="line"></span><br><span class="line">一定要将matplotlib放在最后倒入，不然会出问题</span><br><span class="line"></span><br><span class="line">成昆：</span><br><span class="line"></span><br><span class="line">![image-20210824184908267](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824184908267.png)</span><br><span class="line"></span><br><span class="line">让原本部署到树莓派的程序使用本模型：</span><br><span class="line"></span><br><span class="line">报错：</span><br><span class="line"></span><br><span class="line">from object_detection.protos import string_int_label_map_pb2</span><br><span class="line">ImportError: cannot import name ‘string_int_label_map_pb2’</span><br><span class="line"></span><br><span class="line">网上都说是在说protos文件夹没有这个文件</span><br><span class="line"></span><br><span class="line">但是</span><br><span class="line"></span><br><span class="line">![image-20210824191540441](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824191540441.png)</span><br><span class="line"></span><br><span class="line">也不行</span><br><span class="line"></span><br><span class="line">https://stackoverflow.com/questions/60999011/importerror-cannot-import-name-string-int-label-map-pb2-on-windows</span><br><span class="line"></span><br><span class="line">这个人和我问题一样</span><br><span class="line"></span><br><span class="line">![image-20210824192602444](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824192602444.png)</span><br><span class="line"></span><br><span class="line">原来我以前也遇到过这个问题，这就是不记笔记的傻逼的下场，</span><br><span class="line"></span><br><span class="line">。。。不对啊，之前能跑就说明这个东西是没问题的啊，啥也没改就突然有问题了？寄了</span><br><span class="line"></span><br><span class="line">原来我是直接将该文件放在utils文件夹下，然后直接import</span><br><span class="line"></span><br><span class="line">![image-20210824193315371](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210824193315371.png)</span><br><span class="line"></span><br><span class="line">绝了，</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>pip install urllib3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">完成：能成功检测了，但是正确率非常低，一直都会有window出现</span><br><span class="line"></span><br><span class="line">发现原来这两行是预训练模型的位置</span><br><span class="line"></span><br><span class="line">![image-20210825001231312](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210825001231312.png)</span><br><span class="line"></span><br><span class="line">我靠，我之前删掉了，难怪这么低</span><br><span class="line"></span><br><span class="line"># coco数据集整理</span><br><span class="line"></span><br><span class="line">1. 下载coco数据集：文件结构如下：（person_keypoints是人体结构的标注）</span><br><span class="line"></span><br><span class="line">![image-20210825220723003](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210825220723003.png)</span><br><span class="line"></span><br><span class="line">1. 将coco数据集的instance.json提取出来，转换为xml文件</span><br><span class="line"></span><br><span class="line">2. 将xml对应的图片拿出来和xml文件放在一起</span><br><span class="line"></span><br><span class="line">   ![image-20210825223314606](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210825223314606.png)</span><br><span class="line"></span><br><span class="line">3. 将一步的train文件和n04589890合并到imgs_xml文件夹(之后就是重复之前的步骤了)</span><br><span class="line"></span><br><span class="line">4. 用xml_to_csv.py和csv_to_tfrecord.py生成tfrecord文件</span><br><span class="line"></span><br><span class="line">5. 编辑my_label_map.pbtxt和ssdlite_mobilenet_v2_coco.config文件</span><br><span class="line"></span><br><span class="line">6. 训练，使用（估计要训练一年）</span><br><span class="line"></span><br><span class="line">发现问题：n04589890这个文件夹里的xml文件中的是n04589890，而不是window，需要换掉</span><br><span class="line"></span><br><span class="line">修改此处：</span><br><span class="line"></span><br><span class="line">![image-20210826102651880](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210826102651880.png)</span><br><span class="line"></span><br><span class="line">![image-20210826103140941](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210826103140941.png)</span><br><span class="line"></span><br><span class="line">打印出来才发现</span><br><span class="line"></span><br><span class="line">![image-20210826103154570](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210826103154570.png)</span><br><span class="line"></span><br><span class="line">改成</span><br><span class="line"></span><br><span class="line">运行csv_to_tfrecord的时候发现不能使用JPEG格式，于是，使用jpeg_to_jpg.py （直接运行）让将n04589890里的图片以jpg格式保存到imgs_xml中</span><br><span class="line"></span><br><span class="line">再次运行csv_to_tfrecord</span><br><span class="line"></span><br><span class="line">玩毛，还是报一样的错：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>with open(image_path, ‘rb’) as file:<br>FileNotFoundError: [Errno 2] No such file or directory: ‘imgs_xml\n04589890_10327’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">print一下image_path:</span><br><span class="line"></span><br><span class="line">![image-20210826110956289](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210826110956289.png)</span><br><span class="line"></span><br><span class="line">打开csv文件：</span><br><span class="line"></span><br><span class="line">![image-20210826120347139](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210826120347139.png)</span><br><span class="line"></span><br><span class="line">发现这里就没有.jpg</span><br><span class="line"></span><br><span class="line">![image-20210826151925235](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210826151925235.png)</span><br><span class="line"></span><br><span class="line">在生成csv的py文件中添加如上代码，运行</span><br><span class="line"></span><br><span class="line">成功生成</span><br><span class="line"></span><br><span class="line"># 训练：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python object_detection&#x2F;model_main.py –pipeline_config_path&#x3D;training_my&#x2F;ssd_mobilenet_v2_oid_v4.config –model_dir&#x3D;training_my –alsologtostderr</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">报错：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>label_map.ParseFromString(label_map_string)<br>TypeError: a bytes-like object is required, not ‘str’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20210826154435740](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210826154435740.png)</span><br><span class="line"></span><br><span class="line">原来是这里用成了中文的引号</span><br><span class="line"></span><br><span class="line">再次运行，报错：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>File “D:\code\目标检测\models\research\object_detection\eval_util.py”, line 1098, in get_evaluators<br>    raise ValueError(‘Metric not found: {}’.format(eval_metric_fn_key))<br>ValueError: Metric not found: open_images_V2_detection_metrics</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20210826161021087](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210826161021087.png)</span><br><span class="line"></span><br><span class="line">看样子应该是没有这个文件，感觉最近运气有点好（有进度的感觉好好）</span><br><span class="line"></span><br><span class="line">换成：`oid_V2_detection_metrics`</span><br><span class="line"></span><br><span class="line">每次运行都会卡在这里</span><br><span class="line"></span><br><span class="line">![image-20210826182217305](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210826182217305.png)</span><br><span class="line"></span><br><span class="line">这个人的问题和我一样</span><br><span class="line"></span><br><span class="line">https://stackoverflow.com/questions/59609378/tensorflow-object-detection-api-training-fails-silently（无解决）</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/u010122972/article/details/77387429</span><br><span class="line"></span><br><span class="line">这句话的意思是，将下面这行移出，让评估无期限得进行下去（哪路或多）</span><br><span class="line"></span><br><span class="line">![image-20210826185139808](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210826185139808.png)</span><br><span class="line"></span><br><span class="line">加上</span><br><span class="line"></span><br><span class="line">使用fast_rcnn:</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python object_detection&#x2F;model_main.py –pipeline_config_path&#x3D;training_my&#x2F;faster_rcnn_inception_resnet_v2_atrous_oid_v4.config –model_dir&#x3D;training_my –alsologtostderr</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">会报错，无法运行</span><br><span class="line"></span><br><span class="line">用回oid：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python object_detection&#x2F;model_main.py –pipeline_config_path&#x3D;training_my&#x2F;ssd_mobilenet_v2_oid_v4.config –model_dir&#x3D;training_my –alsologtostderr</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">还是卡在</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>I0829 22:08:23.212716 33152 session_manager.py:502] Done running local_init_</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20210829224419128](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210829224419128.png)</span><br><span class="line"></span><br><span class="line">突然想到是不是我训练集的图片太多了导致的？</span><br><span class="line"></span><br><span class="line">![image-20210829224558772](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210829224558772.png)</span><br><span class="line"></span><br><span class="line">coco数据集里的训练集只有两千张，imgnet的数据集不多，所以应该也差不多三千罢了</span><br><span class="line"></span><br><span class="line">![image-20210829225555627](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210829225555627.png)</span><br><span class="line"></span><br><span class="line">将这里修改，为0.01,原本为0.1，所以测试图片也该变为六百多张</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/qq_28019591/article/details/86560116</span><br><span class="line"></span><br><span class="line">![image-20210829232927010](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210829232927010.png)</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/qq_37541097/article/details/101711261</span><br><span class="line"></span><br><span class="line">![image-20210829233941134](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210829233941134.png)</span><br><span class="line"></span><br><span class="line">原来如此：</span><br><span class="line"></span><br><span class="line">对config文件做如下修改：</span><br><span class="line"></span><br><span class="line">![image-20210830000156870](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210830000156870.png)</span><br><span class="line"></span><br><span class="line">会报错</span><br><span class="line"></span><br><span class="line">![image-20210830000425045](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210830000425045.png)</span><br><span class="line"></span><br><span class="line">改回去</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python object_detection&#x2F;model_main.py –pipeline_config_path&#x3D;training_my&#x2F;ssd_mobilenet_v2_oid_v4.config –model_dir&#x3D;training_my –sample_1_of_n_eval_examples&#x3D;25 –alsologtostderr </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">有用：只卡了几分钟了</span><br><span class="line"></span><br><span class="line">![image-20210830003000559](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210830003000559.png)</span><br><span class="line"></span><br><span class="line">然而效果很差，打开一看模型只有50M（原模型有190M）</span><br><span class="line"></span><br><span class="line">![image-20210830164234903](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210830164234903.png)</span><br><span class="line"></span><br><span class="line">没有一张检测出来，gg，回到解放前</span><br><span class="line"></span><br><span class="line">几把炸裂</span><br><span class="line"></span><br><span class="line">## 怎么办？</span><br><span class="line"></span><br><span class="line">### 分析问题原因：</span><br><span class="line"></span><br><span class="line">1. 没有使用原来的模型，路径出错了</span><br><span class="line"></span><br><span class="line">![image-20210830165242041](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210830165242041.png)</span><br><span class="line"></span><br><span class="line">1. 模型效果本身就不好（也不太可能）</span><br><span class="line">2. 训练step不够：</span><br><span class="line">   - 做如下修改</span><br><span class="line">   - ![image-20210830165615824](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210830165615824.png)</span><br><span class="line">   - 训练到五万个batch，效果还是无法看</span><br><span class="line">   - </span><br><span class="line">   - </span><br><span class="line"></span><br><span class="line">3. 是评估的图片太少导致训练效果不好（不太可能，那个人用100张图片训练出来的照样可以检测）</span><br><span class="line">4. 人和窗户图片数量相差太多导致训练效果不好</span><br><span class="line"></span><br><span class="line">**将模型保存设置为十万个steps保存一次**</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/natures66/article/details/106080898</span><br><span class="line"></span><br><span class="line">根据这篇文章</span><br><span class="line"></span><br><span class="line">![image-20210831163456211](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210831163456211.png)</span><br><span class="line"></span><br><span class="line">还是不行，这样每次训练就得两小时起步了，还是改回十分钟保存一次吧</span><br><span class="line"></span><br><span class="line">1. 图片size不一致导致定位不准：</span><br><span class="line"></span><br><span class="line">   ![image-20210902163430577](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210902163430577.png)</span><br><span class="line"></span><br><span class="line">   不是这个问题，每个图片使用的都是自己的width，height</span><br><span class="line"></span><br><span class="line">2. 发现问题：coco数据集里的人都是多个人的，而xml_to_csv.py都是使用的第一个object</span><br><span class="line"></span><br><span class="line">   发现上面的xmin_list使用的是list，所以这个cvs_to_tfrecord.py 其实是支持一张图片中有多个人的，只是xml_to_csv.py没有把多个人存入csv中，所以</span><br><span class="line"></span><br><span class="line">   我们对xml_to_csv.py做如下修改：</span><br><span class="line"></span><br><span class="line">   乌龙：其实不需要修改</span><br><span class="line"></span><br><span class="line">   ![image-20210902171434761](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210902171434761.png)</span><br><span class="line"></span><br><span class="line">   这个东西每张图片的人都能检测到。误会解除</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>   image_resizer {<br>         fixed_shape_resizer {<br>           height: 300<br>           width: 300<br>         }<br>       }<br>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   好像并没有解除，这是config文件里的（意义不明）</span><br><span class="line"></span><br><span class="line">   https://blog.csdn.net/l13022736018/article/details/108619875根据这篇文章，(暂时搁置)</span><br><span class="line"></span><br><span class="line">3. 今天睡午觉的时候突然想到会不会是学习率和训练batch_steps不匹配导致训练效果很差，比如这个配置文件里的学习率就是要到一千万个batch才有效果</span><br><span class="line"></span><br><span class="line">   解决办法：</span><br><span class="line"></span><br><span class="line">   - https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf1_detection_zoo.md</span><br><span class="line">   - 复制ssd_coco_v2的链接，再打开迅雷，会自动下载</span><br><span class="line">   - 解压到object_detection目录下再解压</span><br><span class="line">   - 复制sample/configs/里对应的config文件到train_my目录下修改对应record路径和模型路径和num_class</span><br><span class="line">   - 运行</span><br><span class="line">   - `python object_detection/model_main.py --pipeline_config_path=training_my/ssd_mobilenet_v2_coco.config --model_dir=training_my --sample_1_of_n_eval_examples=25 --alsologtostderr    -    开始运行孩童检测生成步骤同上运行```shellpython object_detection/model_main.py --pipeline_config_path=training/ssd_mobilenet_v2_coco.config --model_dir=training  --alsologtostderr     `</span><br><span class="line"></span><br><span class="line"># 视频传输</span><br><span class="line"></span><br><span class="line">**使用python进行将摄像头捕获到的视频传输到云服务器上**</span><br><span class="line"></span><br><span class="line">[https://blog.csdn.net/qq_42722197/article/details/109665279?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-3.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-3.no_search_link](https://blog.csdn.net/qq_42722197/article/details/109665279?utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-3.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-3.no_search_link)</span><br><span class="line"></span><br><span class="line">根据这篇文章，</span><br><span class="line"></span><br><span class="line">先克隆下来：`https://github.com/NakulLakhotia/Live-Streaming-using-OpenCV-Flask`</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>pip install flask<br>#报错，can&#96;t import ContextVar，csdn说版本太高了<br>pip install flask&#x3D;&#x3D;1.0 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">运行app.py</span><br><span class="line"></span><br><span class="line">在本机5000 端口查看，成功显示摄像头</span><br><span class="line"></span><br><span class="line">然而这是需要前端请求然后才能开启摄像头，我们需要的是在一直拍摄中将数据一直传到服务器</span><br><span class="line"></span><br><span class="line">[https://www.cnblogs.com/syy1757528181/p/14333286.html，这篇文章非常详细，https://blog.csdn.net/huhumama0/article/details/9164873?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.no_search_link](https://www.cnblogs.com/syy1757528181/p/14333286.html，这篇文章非常详细，https://blog.csdn.net/huhumama0/article/details/9164873?utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link)</span><br><span class="line"></span><br><span class="line">然后发现小组成员使用了frp这个工具来进行视频传输，也就是说从树莓派到服务器，到手机的视屏传输都是这个东西在负责，也就是说如果不用这个东西了，就需要自己写服务器接受数据再传到安卓手机的代码，工作量是一个未知数。</span><br><span class="line"></span><br><span class="line">现有两种办法：</span><br><span class="line"></span><br><span class="line">1. 使用代码将数据封装成原来frp树莓派端发送数据的格式</span><br><span class="line"></span><br><span class="line">   需要：查看frp源代码，找出封装数据的格式</span><br><span class="line"></span><br><span class="line">2. 在localtion.py中调用frp的树莓派端的程序。然后在frp程序调用摄像头之前，将摄像头资源变为全局变量。</span><br><span class="line"></span><br><span class="line">这个内网穿透工具的意思是，你请求服务器加端口地址，服务器将请求转发给树莓派，然后树莓派将视屏发给浏览器（或者服务器，这个无所谓了，知道前面的流程就行了）</span><br><span class="line"></span><br><span class="line">也就是说第一个办法直接作废，因为这是一个被动的过程。（好像也不是作废，算了还是搞第二种吧）</span><br><span class="line"></span><br><span class="line">https://www.cnblogs.com/mulanhao/p/15167562.html，根据这篇文章，这个只是个传数据的方式，根本没有调用摄像头</span><br><span class="line"></span><br><span class="line">还是得用motion：motion就是提供局域网内实时监控的的工具，结合上面的内网穿透工具，就相当于将浏览器和树莓派置于同一网段下了，所以可以使用motion监控</span><br><span class="line"></span><br><span class="line">github：https://github.com/sackmotion/motion</span><br><span class="line"></span><br><span class="line">现在又两种办法：</span><br><span class="line"></span><br><span class="line">1. 将在调用motion的时候用python将摄像头资源提取出来</span><br><span class="line">2. 在树莓派上使用127.0.0.1：8181获得motion传过来的数据</span><br><span class="line"></span><br><span class="line">显然后者比较靠谱，前者相当于提取一个进程正在使用的资源（但是如果是在这个进程开启之前通共享）</span><br><span class="line"></span><br><span class="line">https://www.cnblogs.com/Yunrui-blogs/p/12690080.html，这个人提供了查看树莓派被摄像头状态的</span><br><span class="line"></span><br><span class="line">好像cv2capture(url)可以直接获取网络摄像头的数据，不过不知道motion提供的是不是网络摄像头（看性质完全符合）</span><br><span class="line"></span><br><span class="line">**成功**</span><br><span class="line"></span><br><span class="line">## 启动motion命令：</span><br><span class="line"></span><br><span class="line">root权限下,/home/motion目录下：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>service motion start<br>motion</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">浏览器请求端口：8081</span><br><span class="line"></span><br><span class="line">然后是不打开摄像头的情况下使用：（注释掉这些就行了）</span><br><span class="line"></span><br><span class="line">![image-20210907191535871](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210907191535871.png)</span><br><span class="line"></span><br><span class="line">这个红框中的if是和while true在同一级下的，所以没了这个，就没有了跳出while的手段，所以会一直检测下去，不能释放</span><br><span class="line"></span><br><span class="line">if里面的句子意思是如果这张图片显示了25毫秒，并且有人按了‘q’就退出程序</span><br><span class="line"></span><br><span class="line">所以我们修改成这样</span><br><span class="line"></span><br><span class="line">![image-20210907202234153](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210907202234153.png)</span><br><span class="line"></span><br><span class="line">就能在树莓派上不开显示器使用模型进行检测了，还是‘q’退出</span><br><span class="line"></span><br><span class="line"># 检测</span><br><span class="line"></span><br><span class="line">在b站上爬了一个儿童爬窗户的视频</span><br><span class="line"></span><br><span class="line">先使用官方模型进行检测</span><br><span class="line"></span><br><span class="line">video_detection.py(要修改的东西就在第一段)</span><br><span class="line"></span><br><span class="line">但是编码格式报错，我使用的是flv文件</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/u013913216/article/details/82144395</span><br><span class="line"></span><br><span class="line">这篇文章说应该</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>fourcc &#x3D; cv2.VideoWriter_fourcc(‘F’, ‘L’, ‘V’, ‘1’)   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这样</span><br><span class="line"></span><br><span class="line">还是报错：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>OpenCV: FFMPEG: tag 0x31564c46&#x2F;‘FLV1’ is not supported with codec id 21 and format ‘flv &#x2F; FLV (Flash Video)’<br>OpenCV: FFMPEG: fallback to use tag 0x00000002&#x2F;‘????’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">但是上面有一个运行时间，所以这是运行完才报的错，一看成功生成了对应视频文件。**成昆**</span><br><span class="line"></span><br><span class="line">发现一个问题，人的检测效果非常好（即使使用person也能轻松检测出小孩子），窗户的检测效果很差</span><br><span class="line"></span><br><span class="line">让我们不得不重新考虑使用成年和窗户的数据来训练。如果使用孩子的数据集检测效果不好，那就只能使用成年人的了</span><br><span class="line"></span><br><span class="line">运行到十万之后，小孩数据集训练的模型效果很差，反而五万的成人数据集能轻松检测出小孩的身体。（remake，看来是数据集的问题）我让同小组的来训练成人的，我继续训练孩童的，没必要训练完，也许二十万效果就会很好了。但是合作很不愉快，配合得并不是很好。</span><br><span class="line"></span><br><span class="line">使用来检测窗户：</span><br><span class="line"></span><br><span class="line">![image-20210912164156219](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210912164156219.png)</span><br><span class="line"></span><br><span class="line">效果非常好，但是有个问题，并不能很好地检测出训练集里面的窗户（里面的窗户非常不规整，不是这种四四方方的），但是考虑到实际情况也是像图片里这种将摄像头正对着窗户的。所以也无需考虑。</span><br><span class="line"></span><br><span class="line">目前为止，可以说是基本完工了，上学期就和同一小组成员计划好了，先弄这个简单的目标检测来保底，然后尝试用tf-posenet来实现动作检测。所以这里让另外一位worker去尝试。</span><br><span class="line"></span><br><span class="line">刚刚洗澡的时候突然回忆起，coco数据集中人体关节的标签，于是有下面的推测：动作检测并不是检测一定帧的图片，而是仍然检测一张图片，根据图中关节的位置来做判断。如此就跟目标检测差不多了。看看期中后有没有时间来做吧</span><br><span class="line"></span><br><span class="line">刚刚洗内裤的时候突然想起，不同的项目api不同检测的时候掉两遍api，使用两次视频流是个需要解决的问题（不知道怎么做）。但是现在想到其实可以用掉两次motion的网络视频，运行两个程序，当两个程序都发出报警信号的时候才视为危险（一种方法是修改服务器的接受信号变量，增加一个危险信号2，当两个危险信号都为true的时候才报警（有点麻烦，需要让另一个同学动刀）。另一种方法树莓派内部传递信号，将目标检测程序的危险信号发给动作检测程序（还不知道怎么做））</span><br><span class="line"></span><br><span class="line"># 设计开机自启动</span><br><span class="line"></span><br><span class="line">以后再也不用去另一栋楼里了</span><br><span class="line"></span><br><span class="line">根据这篇文章</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/qq_38960682/article/details/80259321</span><br><span class="line"></span><br><span class="line">简简单单，希望不要出问题</span><br><span class="line"></span><br><span class="line">编写这两个文件，然后复制到/home/pi/.config/autostart</span><br><span class="line"></span><br><span class="line">![image-20210914232434476](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210914232434476.png)</span><br><span class="line"></span><br><span class="line">重启树莓派即可</span><br><span class="line"></span><br><span class="line">失败，又找了很多文章，说要改什么etc/rc.local文件，还是没用</span><br><span class="line"></span><br><span class="line">算了还是吧命令给组长，让组长每次自己启动吧</span><br><span class="line"></span><br><span class="line"># 整合docker</span><br><span class="line"></span><br><span class="line">## 安装yum</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>apt install yum</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">报错：</span><br><span class="line"></span><br><span class="line">apt install yum E: 无法获得锁 /var/lib/dpkg/lock - open (11: 资源暂时不可用)</span><br><span class="line"></span><br><span class="line">不是root的问题，</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/qq_42272783/article/details/102666528</span><br><span class="line"></span><br><span class="line">使用这篇文章中暴力破解法（解决）</span><br><span class="line"></span><br><span class="line">## 安装Docker</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>apt  install docker.io</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 官网下载：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="From-the-root-of-the-git-repository"><a href="#From-the-root-of-the-git-repository" class="headerlink" title="From the root of the git repository"></a>From the root of the git repository</h1><p>docker build -f research&#x2F;object_detection&#x2F;dockerfiles&#x2F;tf1&#x2F;Dockerfile -t od .<br>docker run -it od</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20210830195137522](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210830195137522.png)</span><br><span class="line"></span><br><span class="line">卡在这里半个小时</span><br><span class="line"></span><br><span class="line">将官网的复制dockerfile复制下来粘贴到本地：</span><br><span class="line"></span><br><span class="line">并没有什么乱用，暂时放弃</span><br><span class="line"></span><br><span class="line">## 环境搭建</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>conda info -e</p>
<p>conda create -n tf-pose python&#x3D;3.6</p>
<p>source activate<br>conda activate tf-pose<br>cd models&#x2F;research</p>
<h1 id="Compile-protos"><a href="#Compile-protos" class="headerlink" title="Compile protos."></a>Compile protos.</h1><p>protoc object_detection&#x2F;protos&#x2F;*.proto –python_out&#x3D;.</p>
<h1 id="Install-TensorFlow-Object-Detection-API"><a href="#Install-TensorFlow-Object-Detection-API" class="headerlink" title="Install TensorFlow Object Detection API."></a>Install TensorFlow Object Detection API.</h1><p>cp object_detection&#x2F;packages&#x2F;tf1&#x2F;setup.py .<br>python -m pip install –use-feature&#x3D;2020-resolver .</p>
<p>python object_detection&#x2F;builders&#x2F;model_builder_tf1_test.py</p>
<p>#如果出现no module named official错误</p>
<p>1PYTHONPATH&#x3D;path\to\models</p>
<p>cd models</p>
<p>执行 export PYTHONPATH&#x3D;$PYTHONPATH:<code>pwd</code>:<code>pwd</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 总结</span><br><span class="line"></span><br><span class="line">（上学期就只用了官网的模型）八月十七号开始搞，九月十六号晚上结束。第一周基本上是除了睡觉吃饭洗澡，就在搞这个（速度很慢，很多问题），第二周开始普通工作时间来搞（一个问题卡了快一周，心态发生了变化），第三周基本就是改进（包括换数据集，测试使用docker，测试视频等等），最后这一周就是去上课，吃饭的时候，让电脑自己训练。</span><br><span class="line"></span><br><span class="line">work的时候写这样一篇杂记是非常重要的，特别是什么都不知道的情况下（其实即使精通了也该写，只不过写得少一点）。在你用**控制变量法**做实验的时候，如果没有把自己之前做过的事写下来，很有可能因为忘了做没做而又需要再做一遍。如果有这样一篇杂记，就能`ctrl+f`一下就行了。</span><br><span class="line"></span><br><span class="line"># 再就业</span><br><span class="line"></span><br><span class="line">需求，神偷鬼墨地使用官方的检测b栈下载的视屏中的小孩子和窗子：</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/qq_33507306/article/details/92847413</span><br><span class="line"></span><br><span class="line">根据这篇文章将util里的visualization_utils.py，修改:(加上if和它上面那一句，再将后面的缩进)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>display_str_list &#x3D; box_to_display_str_map[box]<br>  if ((“Person”) in display_str_list[0]or(“Window”) in display_str_list[0]<br>          or(“Man”) in display_str_list[0]or(“Woman”) in display_str_list[0]<br>          ):<br>      draw_bounding_box_on_image_array(<br>          image,<br>          ymin,<br>          xmin,<br>          ymax,<br>          xmax,<br>          color&#x3D;color,<br>          thickness&#x3D;0 if skip_boxes else line_thickness,<br>          display_str_list&#x3D;box_to_display_str_map[box],<br>          use_normalized_coordinates&#x3D;use_normalized_coordinates)<br>      if keypoints is not None:<br>        keypoint_scores_for_box &#x3D; None<br>        if box_to_keypoint_scores_map:<br>          keypoint_scores_for_box &#x3D; box_to_keypoint_scores_map[box]<br>        draw_keypoints_on_image_array(<br>            image,<br>            box_to_keypoints_map[box],<br>            keypoint_scores_for_box,<br>            min_score_thresh&#x3D;min_score_thresh,<br>            color&#x3D;color,<br>            radius&#x3D;line_thickness &#x2F; 2,<br>            use_normalized_coordinates&#x3D;use_normalized_coordinates,<br>            keypoint_edges&#x3D;keypoint_edges,<br>            keypoint_edge_color&#x3D;color,<br>            keypoint_edge_width&#x3D;line_thickness &#x2F;&#x2F; 2)</p>
<p>return image</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后发现用错模型了，应该用oid，而不是coco，coco里没有窗子。gg，树莓派应该也g了</span><br><span class="line"></span><br><span class="line">实践过程中，发现可以将原pbtxt文件中的需要的item，copy下来，然后自己创建一个my.pbtxt.调用自己的这个，没有任何问题，（其他检测的会显示成N/A）</span><br><span class="line"></span><br><span class="line">然后我们再根据这篇文章</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/qq_33507306/article/details/92847413</span><br><span class="line"></span><br><span class="line">将不显示所有的NA方框，那就能得到我们所需要的，只显示孩子和窗户的程序了</span><br><span class="line"></span><br><span class="line">使用程序将b栈视屏检测：</span><br><span class="line"></span><br><span class="line">发现问题：</span><br><span class="line"></span><br><span class="line">![image-20211103222251474](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20211103222251474.png)</span><br><span class="line"></span><br><span class="line">只能在进度条上看见检测框。？gg</span><br><span class="line"></span><br><span class="line">怀疑：检测时权重常在49到五十之间，五十的画面只有几帧，一闪而过，人眼分辨不出导致了上面的情况</span><br><span class="line"></span><br><span class="line">办法：将权重下调至40%甚至30%</span><br><span class="line"></span><br><span class="line">![image-20211104105000147](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20211104105000147.png)</span><br><span class="line"></span><br><span class="line">新增这一行。</span><br><span class="line"></span><br><span class="line"># 延迟和掉帧</span><br><span class="line"></span><br><span class="line">现在来解决这个老问题，</span><br><span class="line"></span><br><span class="line">## 思路一：</span><br><span class="line"></span><br><span class="line">使用tflite模型，</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/zjj7725/article/details/103048414</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python object_detection&#x2F;export_tflite_ssd_graph.py –pipeline_config_path&#x3D;object_detection&#x2F;samples&#x2F;configs&#x2F;ssd_mobilenet_v2_oid_v4.config –trained_checkpoint_prefix&#x3D;object_detection&#x2F;ssd_mobilenet_v2_oid_v4_2018_12_12&#x2F;model.ckpt –output_directory&#x3D;object_detection&#x2F;ssdtflite –add_postprocessing_op&#x3D;true</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">一定要在research下运行，不然会报错，没有protos</span><br><span class="line"></span><br><span class="line">根据这篇文章的最后一部分，将原pb模型文件转化为tflite文件，里面需要下载tensorflow1.13和bazel</span><br><span class="line"></span><br><span class="line">https://www.cnblogs.com/zjutzz/p/10182099.html</span><br><span class="line"></span><br><span class="line">根据这篇文章安装bazel：</span><br><span class="line"></span><br><span class="line">下面总结一下上两步：</span><br><span class="line"></span><br><span class="line">1. 下载tensorflow.zip，解压</span><br><span class="line">2. 下载bazel.exe,这里要将原名字重命名，原名字一大串</span><br><span class="line">3. 将上诉exe文件添加到环境变量中。</span><br><span class="line"></span><br><span class="line">生成中间文件命令</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python object_detection&#x2F;export_tflite_ssd_graph.py –pipeline_config_path&#x3D;&#x2F;usr&#x2F;local&#x2F;anaconda3&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;tensorflow&#x2F;models&#x2F;research&#x2F;object_detection&#x2F;legacy&#x2F;train&#x2F;pipeline.config –trained_checkpoint_prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;anaconda3&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;tensorflow&#x2F;models&#x2F;research&#x2F;object_detection&#x2F;legacy&#x2F;train&#x2F;model.ckpt-80000 –output_directory&#x3D;&#x2F;usr&#x2F;local&#x2F;anaconda3&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;tensorflow&#x2F;models&#x2F;research&#x2F;object_detection&#x2F;legacy&#x2F;train –add_postprocessing_op&#x3D;true<br>#注意改地址，名字</p>
<p>#第二步<br>cd tensorflow-1.13.1&#x2F;<br>bazel build tensorflow&#x2F;python&#x2F;tools:freeze_graph<br>bazel build tensorflow&#x2F;lite&#x2F;toco:toco</p>
<p>#第三步<br>bazel run tensorflow&#x2F;lite&#x2F;toco:toco – <br>–input_file&#x3D;&#x2F;usr&#x2F;local&#x2F;anaconda3&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;tensorflow&#x2F;models&#x2F;research&#x2F;object_detection&#x2F;legacy&#x2F;train&#x2F;tflite_graph.pb <br>–output_file&#x3D;&#x2F;usr&#x2F;local&#x2F;anaconda3&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;tensorflow&#x2F;models&#x2F;research&#x2F;object_detection&#x2F;legacy&#x2F;train&#x2F;detect.tflite <br>–input_shapes&#x3D;1,300,300,3 <br>–input_arrays&#x3D;normalized_input_image_tensor <br>–output_arrays&#x3D;’TFLite_Detection_PostProcess’,’TFLite_Detection_PostProcess:1’,’TFLite_Detection_PostProcess:2’,’TFLite_Detection_PostProcess:3’ <br>–inference_type&#x3D;FLOAT <br>–allow_custom_ops</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">第二步的时候报错：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ERROR: C:&#x2F;users&#x2F;windsfox&#x2F;_bazel_windsfox&#x2F;3c2menqx&#x2F;external&#x2F;io_bazel_rules_closure&#x2F;closure&#x2F;templates&#x2F;closure_java_template_library.bzl:185:15: name ‘PACKAGE_NAME’ is not defined<br>ERROR: error loading package ‘’: at C:&#x2F;users&#x2F;windsfox&#x2F;_bazel_windsfox&#x2F;3c2menqx&#x2F;external&#x2F;io_bazel_rules_closure&#x2F;closure&#x2F;defs.bzl:24:6: compilation of module ‘closure&#x2F;templates&#x2F;closure_java_template_library.bzl’ failed<br>INFO: Elapsed time: 0.255s<br>INFO: 0 processes.<br>FAILED: Build did NOT complete successfully (0 packages loaded)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">gg</span><br><span class="line"></span><br><span class="line">有找到一篇文章：https://blog.csdn.net/jiangjiang4564/article/details/107379916/?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-1.no_search_link&amp;spm=1001.2101.3001.4242.2</span><br><span class="line"></span><br><span class="line">![image-20211106181145735](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20211106181145735.png)</span><br><span class="line"></span><br><span class="line">心里默念，我不是最倒霉的那一个。（原来看别人倒霉是真的可以让原本难过的心情变好的）</span><br><span class="line"></span><br><span class="line">舒服了，虽然tensorflow我也装了两三天</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其实并不需要什么命令行，直接使用pb_to_tflite.py文件运行就是了，舒服了蛐蛐</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 新问题：</span><br><span class="line"></span><br><span class="line">网上有的使用lite，命令后面跟了labels文件的路径</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python3 detect_picamera.py  –model &#x2F;tmp&#x2F;detect.tflite –labels &#x2F;tmp&#x2F;coco_labels.txt<br>#又有的没跟<br>python3 TFLite_detection_webcam.py –modeldir&#x3D;Sample_TFLite_model<br>#草了，到底跟不跟啊。控制变量法<br>#乌龙，其实是要跟的，下面这个是目录，里面有模型文件和txt文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 制作label.txt文件</span><br><span class="line"></span><br><span class="line">到这里我们发现官方ssdoid模型转成的tflite文件没有和他匹配的601个分类的label.txt文件，所以tflite1项目里运行webcam.py的的时候会导致下标越界（如果我们能找到这601的个分类，可以尝试解决问题！！）</span><br><span class="line"></span><br><span class="line">通过使用pycharm中的多行替换功能将`oid_v4_label_map.pbtxt`的所有name提取出来，制作成`oid_v4_label_map.txt`（PS：文本编辑器不允许多行替换。），其中出现过下面问题（想不通）</span><br><span class="line"></span><br><span class="line">![image-20211108165504534](https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20211108165504534.png)</span><br><span class="line"></span><br><span class="line">`（.*?）`是一个字符，`（.*）`是字符串</span><br><span class="line"></span><br><span class="line">## 重新想办法提升训练效果</span><br><span class="line"></span><br><span class="line">然后就是我们自己训练的东西，两万不行，二十万也不行，</span><br><span class="line"></span><br><span class="line">1. 另一个组员在训练100万的，成人和窗户的数据集</span><br><span class="line">2. 现在我们只使用特定的图片来检测人和窗户</span><br><span class="line"></span><br><span class="line"># 针对数据集</span><br><span class="line"></span><br><span class="line">现在怀疑是数据集出了问题，我们其实只需要特定的窗户识别，</span><br><span class="line"></span><br><span class="line">现在拍二十张寝室窗户图片，二十张室友图片，拿来训练。（注意转为csv文件的时候，jpeg文件会出问题，需要手动改一下）</span><br><span class="line"></span><br><span class="line">使用ssd_v2_coco.config训练：速度很慢，两分钟一百个steps。gg（但是gpu显存是占满了的）</span><br><span class="line"></span><br><span class="line">找了一晚上：将config文件换成ssdlite_v2_coco.config,(里面总共训练次数为一万个steps)，并且修改了里面的学习率：改为0.04（原来的为0.004）</span><br><span class="line"></span><br><span class="line">不知道是上面的哪个原因：速度又变快了（40秒一百个steps）</span><br><span class="line"></span><br><span class="line">![image-20211111120720332](https://first-bolg-bucket.oss-cn-beijing.aliyuncs.com/Typora/image-20211111120720332.png)</span><br><span class="line"></span><br><span class="line">失败</span><br><span class="line"></span><br><span class="line">开始尝试只使用两万</span><br><span class="line"></span><br><span class="line"># 偷师同学：</span><br><span class="line"></span><br><span class="line">借用同学分享的数据集，</span><br><span class="line"></span><br><span class="line">在转化为csv的时候报错：</span><br><span class="line"></span><br><span class="line">原因：python中的float类型的字符（理解一下），不能强制转化为int需要：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>int(float(member[4][0].text)),<br>int(float(member[4][1].text)),<br>int(float(member[4][1].text)),<br>int(float(member[4][1].text))</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">报错，直接运行不了。</span><br><span class="line"></span><br><span class="line">原因：这里的二三都写成一了</span><br><span class="line"></span><br><span class="line">![image-20211112180932359](C:%5CUsers%5Cwindsfox%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20211112180932359.png)</span><br><span class="line"></span><br><span class="line">报错：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>tensorflow.python.framework.errors_impl.InvalidArgumentError: 2 root error(s) found.<br>  (0) Invalid argument: assertion failed: [maximum box coordinate value is larger than 1.100000: ] [1.80371094]<br>         [[node ToAbsoluteCoordinates_1&#x2F;Assert&#x2F;AssertGuard&#x2F;Assert (defined at D:\code\ob_work\models\research\object_detection\core\box_list_ops.py:916) ]]<br>         [[map_1&#x2F;while&#x2F;zeros&#x2F;_2603]]<br>  (1) Invalid argument: assertion failed: [maximum box coordinate value is larger than 1.100000: ] [1.80371094]<br>         [[node ToAbsoluteCoordinates_1&#x2F;Assert&#x2F;AssertGuard&#x2F;Assert (defined at D:\code\ob_work\models\research\object_detection\core\box_list_ops.py:916) ]]<br>0 successful operations.<br>0 derived errors ignored.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[https://blog.csdn.net/qq_36414085/article/details/101011895?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.no_search_link](https://blog.csdn.net/qq_36414085/article/details/101011895?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link)</span><br><span class="line"></span><br><span class="line">这位老哥给出了解答：</span><br><span class="line"></span><br><span class="line">终于发现，借鉴的其中一个组的数据，使用的并不是像素来做标签的单位，所以才爆炸的。</span><br><span class="line"></span><br><span class="line">用别的组的</span><br><span class="line"></span><br><span class="line">然后还是报错；原因：png格式的图片不能被训练（训练时报错）。真的倒霉，有一组有十二张png图片。</span><br><span class="line"></span><br><span class="line">放弃那一组</span><br><span class="line"></span><br><span class="line">继续制作数据集，继续训练：</span><br><span class="line"></span><br><span class="line">报错：image_size must contain 3 elements[4]</span><br><span class="line"></span><br><span class="line">https://www.cnblogs.com/chay/p/10447718.html</span><br><span class="line"></span><br><span class="line">这里需要特别注意的一点是不是所有的`.jpg`文件都是三通道的。</span><br><span class="line"></span><br><span class="line">绝了，真的难受。是不是已经把所有问题都遇完了，哈哈哈哈哈哈哈</span><br><span class="line"></span><br><span class="line">打印出不是RGB的图片名字，一个一个删掉</span><br><span class="line"></span><br><span class="line">好了继续前进</span><br><span class="line"></span><br><span class="line">训练时报错：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>tensorflow.python.framework.errors_impl.InvalidArgumentError: assertion failed: [Unable to decode bytes as JPEG, PNG, GIF, or BMP]<br>         [[{ {node case&#x2F;cond&#x2F;cond_jpeg&#x2F;decode_image&#x2F;cond_jpeg&#x2F;cond_png&#x2F;cond_gif&#x2F;Assert_1&#x2F;Assert} }]]<br>         [[IteratorGetNext]]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">https://blog.csdn.net/weixin_39942108/article/details/110484209</span><br><span class="line"></span><br><span class="line">显然这些图片也有些是改过的png格式</span><br><span class="line"></span><br><span class="line">![image-20211112232355118](https://raw.githubusercontent.com/windsfox/blog_img/master/blog/image-20211112232355118.png)</span><br><span class="line"></span><br><span class="line">真的什么牛鬼蛇神都有</span><br><span class="line"></span><br><span class="line">终于成功了</span><br><span class="line"></span><br><span class="line">![image-20211112233402549](https://raw.githubusercontent.com/windsfox/blog_img/master/blog/image-20211112233402549.png)</span><br><span class="line"></span><br><span class="line">报错：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>tensorflow.python.framework.errors_impl.InvalidArgumentError: input must be 4-dimensional[1,91,338,600,3]<br>         [[{ {node ResizeImage&#x2F;resize&#x2F;ResizeBilinear} }]]<br>         [[IteratorGetNext]]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 现在运行的命令：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>python object_detection&#x2F;model_main.py –pipeline_config_path&#x3D;training&#x2F;ssdlite_mobilenet_v2_coco.config –model_dir&#x3D;training  –alsologtostderr</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">查看模型训练情况</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>tensorboard –logdir&#x3D;training</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">http://localhost:6006/查看</span><br><span class="line"></span><br><span class="line">![image-20211113155535044](https://raw.githubusercontent.com/windsfox/blog_img/master/blog/image-20211113155535044.png)</span><br><span class="line"></span><br><span class="line">很显然，loss下降到五左右就不降了</span><br><span class="line"></span><br><span class="line">![image-20211113155705260](https://raw.githubusercontent.com/windsfox/blog_img/master/blog/image-20211113155705260.png)</span><br><span class="line"></span><br><span class="line">但是效果看起来已经很好了</span><br><span class="line"></span><br><span class="line">实践途中发现了，在训练当中，是可以修改喂入的batch_size的，只不过如果改大了，训练时间会增加</span><br><span class="line"></span><br><span class="line">## 对batch_size理解：</span><br><span class="line"></span><br><span class="line">过小，不易于收敛；过大，局部最小值导致loss无法下降（2太小，16过大，效果很拉）</span><br><span class="line"></span><br><span class="line">我们选择4</span><br><span class="line"></span><br><span class="line">![image-20211114164210143](https://raw.githubusercontent.com/windsfox/blog_img/master/blog/image-20211114164210143.png)</span><br><span class="line"></span><br><span class="line">但是正则化loss好像过拟合了</span><br><span class="line"></span><br><span class="line">我们还要随时看着</span><br><span class="line"></span><br><span class="line">![image-20211115162936171](https://raw.githubusercontent.com/windsfox/blog_img/master/blog/image-20211115162936171.png)</span><br><span class="line"></span><br><span class="line">![image-20211115163437673](https://raw.githubusercontent.com/windsfox/blog_img/master/blog/image-20211115163437673.png)</span><br><span class="line"></span><br><span class="line">上面这张图是batch_size为8的时候的训练效果</span><br><span class="line"></span><br><span class="line">太辣了</span><br><span class="line"></span><br><span class="line"># 使用服务器训练</span><br><span class="line"></span><br><span class="line">## 白嫖的阿里服务器</span><br><span class="line"></span><br><span class="line">我发现我之前忽略了一个点，服务器虽然训练得慢，但是它能没日没夜的训练啊，他训练二十四个小时，相当于我们训练三个小时，我还有十五天的试用时间</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>#装完环境，启动conda环境<br>conda activate tf-pose<br>#在research目录下：（注意这里又用的成年人的巨量数据集了）<br>nohup TF_XLA_FLAGS&#x3D;–tf_xla_cpu_global_jit python  object_detection&#x2F;model_main.py –pipeline_config_path&#x3D;training_my&#x2F;ssd_mobilenet_v2_oid_v4.config –model_dir&#x3D;training_my –sample_1_of_n_eval_examples&#x3D;25 –alsologtostderr   &gt;&#x2F;dev&#x2F;null  2&gt;log.file &amp;</p>
<p>vim ~&#x2F;.bashrc<br>export PYTHONPATH&#x3D;$PYTHONPATH:&#x2F;usr&#x2F;local&#x2F;models&#x2F;research:&#x2F;usr&#x2F;local&#x2F;models&#x2F;research&#x2F;slim<br>source ~&#x2F;.bashrc</p>
<p>#报错，没有pycocotools，找了一晚上，最后发现<br>#1.首先安装cyphton<br>pip install cython</p>
<p>#2. 安装pycocotools<br>pip install pycocotools</p>
<h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><p>#报错：libGL.so.1: cannot open shared object file: No such file or directory<br>#<a target="_blank" rel="noopener" href="https://blog.csdn.net/agonysome/article/details/108985079%EF%BC%8C%E8%A7%A3%E5%86%B3">https://blog.csdn.net/agonysome/article/details/108985079，解决</a><br>yum install mesa-libGL.x86_64</p>
<p>#但是每次一运行，直接被killed</p>
<h1 id="https-blog-csdn-net-cxxxxxxxxxxxxx-article-details-106344235，这个老哥写了"><a href="#https-blog-csdn-net-cxxxxxxxxxxxxx-article-details-106344235，这个老哥写了" class="headerlink" title="https://blog.csdn.net/cxxxxxxxxxxxxx/article/details/106344235，这个老哥写了"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/cxxxxxxxxxxxxx/article/details/106344235%EF%BC%8C%E8%BF%99%E4%B8%AA%E8%80%81%E5%93%A5%E5%86%99%E4%BA%86">https://blog.csdn.net/cxxxxxxxxxxxxx/article/details/106344235，这个老哥写了</a></h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20211121225553817](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211121225553817.png)</span><br><span class="line"></span><br><span class="line">但是我已经改成一了，还是直接被killed，绝望</span><br><span class="line"></span><br><span class="line">## 矩池云：</span><br><span class="line"></span><br><span class="line">又看了一堆知乎和csdn，有的人说2g2c的服务器，搭个小网站都吃力。根本不用想机器学习，除非你自己做数字识别这种教学用的。</span><br><span class="line"></span><br><span class="line">于是乎了解到了矩池云这个网站：https://matpool.com/edu</span><br><span class="line"></span><br><span class="line">下午上课的时候，一个朋友说他们综合设计的费用能报销。我问了问我们组长，组长说有的指导老师是可以报销的，我们这个指导老师的实验室懂的都懂。只能自己扛。我们只能小组内分摊。</span><br><span class="line"></span><br><span class="line">### 上传object_detection目录和数据集</span><br><span class="line"></span><br><span class="line">这里发现它提供了一个网盘，刚开始不知道有什么用处。看了这篇文章后，猜测是用来同步主机里的文件的（挂载到主机的/mnt目录下），不然主机时间到后，忘了下载模型就直接gg。但是他只有5个g，再高就要自己购买了</span><br><span class="line"></span><br><span class="line">这里有一个细节：上传的zip文件，解压后，并不会用其名字新建一个文件夹当做第一层（bandzip会），而是直接将里面的所有东西摆在同一级目录</span><br><span class="line"></span><br><span class="line">![image-20211123211707431](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211123211707431.png)</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/m0_45172994/article/details/115786701</span><br><span class="line"></span><br><span class="line">购买了gpu主机之后，会获得一个ssh命令，将其输入到你笔记本的命令行。就可连接到远程（xhell和xftp用不了）</span><br><span class="line"></span><br><span class="line">或者点击下面的朱比特lab链接，直接通过浏览器连接到远程主机。</span><br><span class="line"></span><br><span class="line">跑完之后，点击主机旁边的更多，保存并释放就行了</span><br><span class="line"></span><br><span class="line">### 搭建环境</span><br><span class="line"></span><br><span class="line">https://www.cnblogs.com/matpool/p/15386008.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>conda info -e #查看当前系统有哪些python环境</p>
<p>conda create -n tf-pose python&#x3D;3.6</p>
<p>conda activate tf-pose<br>#搭建环境官方脚本，我已经把tf2的setup.py复制到当前文件夹下了，所以可以直接跑<br>pip install –user –upgrade pip<br>#这条语句可能运行不了，需要更新pip<br>python -m pip install –use-feature&#x3D;2020-resolver .</p>
<p>#添加到环境变量<br>vim ~&#x2F;.bashrc<br>export PYTHONPATH&#x3D;$PYTHONPATH:&#x2F;mnt:&#x2F;mnt&#x2F;slim<br>source ~&#x2F;.bashrc<br>#打印出sh: &#96;exit’: is a special builtin，开始以为是报错，但其实就是一句提示</p>
<p>#测试<br>python object_detection&#x2F;builders&#x2F;model_builder_tf2_test.py</p>
<p>#训练<br>python object_detection&#x2F;model_main.py –pipeline_config_path&#x3D;training_my&#x2F;ssd_mobilenet_v2_oid_v4.config –model_dir&#x3D;training_my –sample_1_of_n_eval_examples&#x3D;25 –alsologtostderr </p>
<p>#报错：ImportError: cannot import name ‘keras_tensor’ from ‘tensorflow.python.keras.engine’ (&#x2F;root&#x2F;miniconda3&#x2F;envs&#x2F;myconda&#x2F;lib&#x2F;python3.7&#x2F;site-packages&#x2F;tensor</p>
<h1 id="https-blog-csdn-net-weixin-41552975-article-details-117846962，根据这篇文章升级到2-5"><a href="#https-blog-csdn-net-weixin-41552975-article-details-117846962，根据这篇文章升级到2-5" class="headerlink" title="https://blog.csdn.net/weixin_41552975/article/details/117846962，根据这篇文章升级到2.5"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41552975/article/details/117846962%EF%BC%8C%E6%A0%B9%E6%8D%AE%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E5%8D%87%E7%BA%A7%E5%88%B02.5">https://blog.csdn.net/weixin_41552975/article/details/117846962，根据这篇文章升级到2.5</a></h1><p>#报错：ValueError: ssd_mobilenet_v2 is not supported. See <code>model_builder.py</code> for features extractors compatible with different versions of Tensorflow<br>#网上基本没有解释，只有英文的在哪里说得不清不楚的。我们还是装回1.14<br>#报错：ImportError: cannot import name ‘resnet’ from ‘tensorflow.python.keras.applications’，网上没有解答<br>#怀疑是python3.7的错误，从新搭建3.6的环境</p>
<h1 id="报错：ImportError-libGL-so-1-cannot-open-shared-object-file-No-such-file-or-directory"><a href="#报错：ImportError-libGL-so-1-cannot-open-shared-object-file-No-such-file-or-directory" class="headerlink" title="报错：ImportError: libGL.so.1: cannot open shared object file: No such file or directory"></a>报错：ImportError: libGL.so.1: cannot open shared object file: No such file or directory</h1><h1 id="https-blog-csdn-net-qq-35516745-article-details-103822597"><a href="#https-blog-csdn-net-qq-35516745-article-details-103822597" class="headerlink" title="https://blog.csdn.net/qq_35516745/article/details/103822597"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35516745/article/details/103822597">https://blog.csdn.net/qq_35516745/article/details/103822597</a></h1><p>sudo apt update<br>sudo apt install libgl1-mesa-glx<br>#没用还是报错<br>#报错：ImportError: cannot import name ‘resnet’ from ‘tensorflow.python.keras.applications’<br>升级到1.15<br>报错没有nets，注意这个时候不要去pip install，那个不是我们需要的<br>我们要的是将slim这个文件夹放在object_detection同级，并且将其添加到PYTHONPATH中。<br>终于ok了，神奇的是我window上用的1.14却没有任何问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20211123224839618](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211123224839618.png)</span><br><span class="line"></span><br><span class="line">然后发现一个致命的问题，cuda版本不匹配，嘿嘿，gg，我是麻瓜，重新租一个</span><br><span class="line"></span><br><span class="line">但是只有2.7版本的python搭配1.15。并且显示框有问题，不能conda activate，草了。</span><br><span class="line"></span><br><span class="line">重新租用cuda10的，python3.6的</span><br><span class="line"></span><br><span class="line">终于成昆了</span><br><span class="line"></span><br><span class="line">### 训练</span><br><span class="line"></span><br><span class="line">上面那篇文章是用pycharm远程连接进行训练的。</span><br><span class="line"></span><br><span class="line">问题：</span><br><span class="line"></span><br><span class="line">1. 如果我直接用xshell，运行后台训练命令，关闭窗口后会不会直接结束进程？</span><br><span class="line">2. 如果上面可以跑，那运行完之后，还会不会扣时间（打算买50卡时，三十天的）</span><br><span class="line"></span><br><span class="line">如果上面的问题不能解决，那我们就用pycharm跑（贼几把麻烦）</span><br><span class="line"></span><br><span class="line">再三思索，决定用后台命令训练，时间方面可以看着每个step的时间，计算一下完成时间，然后到点了自己去关。（网上别人就有这么办的，应该可行）</span><br><span class="line"></span><br><span class="line">![image-20211123232529260](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211123232529260.png)</span><br><span class="line"></span><br><span class="line">![image-20211123232654738](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211123232654738.png)</span><br><span class="line"></span><br><span class="line">batchsize为8，是要比我笔记本的47秒快一点</span><br><span class="line"></span><br><span class="line">将batch改为16，并后台运行</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>nohup python  object_detection&#x2F;model_main.py –pipeline_config_path&#x3D;training_my&#x2F;ssd_mobilenet_v2_oid_v4.config –model_dir&#x3D;training_my –sample_1_of_n_eval_examples&#x3D;25 –alsologtostderr   &gt;&#x2F;dev&#x2F;null  2&gt;log.file &amp;</p>
<p>tensorboard –logdir&#x3D;training_my</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">https://www.cnblogs.com/matpool/p/14504908.html</span><br><span class="line"></span><br><span class="line">根据这篇文章，使用隧道连接，有意思的是xshell中只允许ip地址，不允许域名，所以我们只能使用命令行，进行隧道连接</span><br><span class="line"></span><br><span class="line">因为命令行会dns解析。</span><br><span class="line"></span><br><span class="line">睡觉喽。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ssh -p 26937 -NL 6006:localhost:6006 <a href="mailto:&#114;&#x6f;&#111;&#x74;&#x40;&#104;&#x7a;&#45;&#x74;&#51;&#x2e;&#109;&#x61;&#x74;&#x70;&#x6f;&#111;&#x6c;&#46;&#99;&#x6f;&#x6d;">&#114;&#x6f;&#111;&#x74;&#x40;&#104;&#x7a;&#45;&#x74;&#51;&#x2e;&#109;&#x61;&#x74;&#x70;&#x6f;&#111;&#x6c;&#46;&#99;&#x6f;&#x6d;</a>(最后这个是主机名)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后就可在本地6006访问远程的tensorBoard了</span><br><span class="line"></span><br><span class="line">![image-20211124124146403](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211124124146403.png)</span><br><span class="line"></span><br><span class="line">![image-20211124124103368](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211124124103368.png)</span><br><span class="line"></span><br><span class="line">可以看到对大物体的检测效果已经很好了，但是对小物体的检测效果却很垃圾（这一点我们尽量忽略，因为我们主要是在一个对准窗户的情景下，这样婴儿和窗户都会显得很大）</span><br><span class="line"></span><br><span class="line">![image-20211124131205474](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211124131205474.png)</span><br><span class="line"></span><br><span class="line">现在的问题：检测人的效果非常好，但是窗户基本检测不出来了</span><br><span class="line"></span><br><span class="line"># 训练两个模型，</span><br><span class="line"></span><br><span class="line">一个检测窗户，一个检测人体，检测人体用上面那个就OK了</span><br><span class="line"></span><br><span class="line">现在我们来制作窗户数据集：</span><br><span class="line"></span><br><span class="line">制作好后训练：但这次采用coco的配置文件</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>nohup python object_detection&#x2F;model_main.py –pipeline_config_path&#x3D;training&#x2F;ssdlite_mobilenet_v2_coco.config –model_dir&#x3D;training  –alsologtostderr   &gt;&#x2F;dev&#x2F;null  2&gt;log.file &amp;</p>
<p>ssh -p 29689 -NL 6006:localhost:6006 <a href="mailto:&#114;&#x6f;&#111;&#x74;&#64;&#104;&#122;&#x2d;&#116;&#x33;&#x2e;&#x6d;&#x61;&#116;&#x70;&#x6f;&#x6f;&#x6c;&#46;&#99;&#111;&#109;">&#114;&#x6f;&#111;&#x74;&#64;&#104;&#122;&#x2d;&#116;&#x33;&#x2e;&#x6d;&#x61;&#116;&#x70;&#x6f;&#x6f;&#x6c;&#46;&#99;&#111;&#109;</a></p>
<p>tensorboard –logdir&#x3D;training</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20211124184713604](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211124184713604.png)</span><br><span class="line"></span><br><span class="line">我现在怀疑是coco模型的问题。</span><br><span class="line"></span><br><span class="line">![image-20211124203917869](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211124203917869.png)</span><br><span class="line"></span><br><span class="line">![image-20211124204214095](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211124204214095.png)</span><br><span class="line"></span><br><span class="line">实际效果不太行</span><br><span class="line"></span><br><span class="line">改用oid模型：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>nohup python object_detection&#x2F;model_main.py –pipeline_config_path&#x3D;training&#x2F;ssd_mobilenet_v2_oid_v4.config –model_dir&#x3D;training  –alsologtostderr   &gt;&#x2F;dev&#x2F;null  2&gt;log.file &amp;</p>
<p>python object_detection&#x2F;export_inference_graph.py –input_type&#x3D;image_tensor –pipeline_config_path&#x3D;training&#x2F;ssd_mobilenet_v2_oid_v4.config –trained_checkpoint_prefix&#x3D;training&#x2F;model.ckpt-25390 –output_directory&#x3D;wb3_inference_graph</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">刚开始batchsize为8，二十多秒一个step，训练了一万个steps，两种loss都没下降过，后来改成24，才开始下降了</span><br><span class="line"></span><br><span class="line">![image-20211125144622088](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211125144622088.png)</span><br><span class="line"></span><br><span class="line">白天的效果非常好</span><br><span class="line"></span><br><span class="line">但是我想晚上效果也好：将上一步的batchsize改为16，从0开始训练：</span><br><span class="line"></span><br><span class="line">![image-20211125144803397](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211125144803397.png)</span><br><span class="line"></span><br><span class="line">可以看到分类loss不会过高的涨幅了，所以理论来说这个模型应该非常完美。</span><br><span class="line"></span><br><span class="line">![image-20211125150648684](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211125150648684.png)</span><br><span class="line"></span><br><span class="line">然而晚上效果还是不好，放弃了。到这里就算完成了</span><br><span class="line"></span><br><span class="line"># 一个Python文件</span><br><span class="line"></span><br><span class="line">同时使用两个模型，进行检测：</span><br><span class="line"></span><br><span class="line">![image-20211124210617129](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211124210617129.png)</span><br><span class="line"></span><br><span class="line">注意到这里，说明不能在一个python中运行两个模型，因为它是相当于在模型里跑图。因为程序是顺序执行，如果你要加载两个，那必须等前一个结束了才能加载第二个模型，所以永远不可能。</span><br><span class="line"></span><br><span class="line">所以我们编写两个python文件，分别检测人和窗户的坐标，然后发送到服务器。（想过两个Python进程传递变量的方法，网上说的贼复杂，果断放弃）</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>nohup python object_detection&#x2F;DetectBabyFinal.py   &gt;&#x2F;dev&#x2F;null  2&gt;log.file &amp;<br>nohup python object_detection&#x2F;DetectWindowFinal.py   &gt;&#x2F;dev&#x2F;null  2&gt;log.file &amp;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 老师提问：</span><br><span class="line"></span><br><span class="line">1. 为什么你的准确率这么低啊？我看别人的准确率都是80%90%，你这怎么是40%50%？</span><br><span class="line"></span><br><span class="line">   答：这是置信度，并不是准确率，别人置信度高，是他调的比较高；我们之前使用自己找的两百多张图片做训练的时候，训练出来的置信度也很高，但是会出现过拟合的状况，将一些类人形物体也检测出来。后来我们用了coco数据集中的人体数据集和imgnet2012中的人体和窗户数据集，置信度就下来了，但是不会出现将其他检测为人体的情况。准确率是指有没有检测出来人，比如说我们这个视屏里有一个小孩，我们检测出来了，这个准确率就是100%，不能一直检测一方面是里面的人可能部分被一些东西挡住，或者移动导致可能在一瞬间检测不出来。</span><br><span class="line"></span><br><span class="line"># 答辩：</span><br><span class="line"></span><br><span class="line">## 机器学习步骤：</span><br><span class="line"></span><br><span class="line">我们使用tensorflow的object_detection做窗户和人的目标检测，因为考虑到现在都是推拉窗户，所以在制作数据集的时候并没有做开关窗户的分类，只做了窗户标签和人的标签。刚开始打算用一个模型同时检测人和窗户，树莓派计算完是否危险后，发送危险信号给服务器；但是估计因为数据量太小或者二者比例问题，效果始终很差，所以我们选择一个模型检测人，一个模型检测窗户，然后将两个坐标发送给服务器，由服务器来计算是否危险状态。</span><br><span class="line"></span><br><span class="line">### 数据集制作：</span><br><span class="line"></span><br><span class="line">- 将自己搜罗的数据集合imgnet2012中部分挑选出来的数据集整合（）：</span><br><span class="line">- ![image-20211231193535350](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211231193535350.png)</span><br><span class="line">- ![image-20211231192759170](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211231192759170.png)</span><br><span class="line">- 制作成tfrecord文件：</span><br><span class="line">- ![image-20211231193111109](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211231193111109.png)</span><br><span class="line"></span><br><span class="line">1. 训练：</span><br><span class="line"></span><br><span class="line">   - 环境：使用矩池云在云上训练，tensorflow版本1.14.0：</span><br><span class="line"></span><br><span class="line">   - 运行命令：</span><br><span class="line"></span><br><span class="line">   - \```shell</span><br><span class="line">     python object_detection/model_main.py –pipeline_config_path=training/ssd_mobilenet_v2_coco.config –model_dir=training –alsologtostderr</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code> - 导出模型：
 
 - ```shell
   python object_detection/export_inference_graph.py --input_type=image_tensor --pipeline_config_path=training/ssdlite_mobilenet_v2_coco.config --trained_checkpoint_prefix=training/model.ckpt-200000 --output_directory=wb2_inference_graph
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   - 效果检测：</span><br><span class="line"></span><br><span class="line">   - ![image-20211231193911793](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211231193911793.png)</span><br><span class="line"></span><br><span class="line">   - ![image-20211231193946364](https://gitee.com/gitzuo/blog2021/raw/master/blog2021/image-20211231193946364.png)</span><br><span class="line"></span><br><span class="line">### 代码分析：</span><br><span class="line"></span><br><span class="line">主要还是数据集的处理比较麻烦，训练有现成的python文件</span><br><span class="line"></span><br><span class="line">#### 数据集制作：</span><br><span class="line"></span><br><span class="line">1. 查询不是三通道的图片</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
<p>   from PIL import Image<br>   import os</p>
<h1 id="查询一个文件夹下所有不是三通道的图片"><a href="#查询一个文件夹下所有不是三通道的图片" class="headerlink" title="查询一个文件夹下所有不是三通道的图片"></a>查询一个文件夹下所有不是三通道的图片</h1><p>   path &#x3D; ‘imgs_xml&#x2F;‘ #图片目录<br>   for file in os.listdir(path):</p>
<pre><code>    extension = file.split(&#39;.&#39;)[-1]
    if extension == &#39;jpg&#39;:
          fileLoc = path+file
          img = Image.open(fileLoc)
          if img.mode != &#39;RGB&#39;:
                print(file+&#39;, &#39;+img.mode)
</code></pre>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 查看图片编码形式</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>   import imghdr,os</p>
<h1 id="查询一个文件夹下所有不是jpeg格式的图片"><a href="#查询一个文件夹下所有不是jpeg格式的图片" class="headerlink" title="查询一个文件夹下所有不是jpeg格式的图片"></a>查询一个文件夹下所有不是jpeg格式的图片</h1><p>   #filename &#x3D; ‘img.py’</p>
<p>   from PIL import Image<br>   import os<br>   path &#x3D; ‘imgs_xml&#x2F;‘ #图片目录<br>   for file in os.listdir(path):<br>       filename &#x3D; path+file<br>       imgType &#x3D; imghdr.what(filename)<br>       if imgType:<br>           if imgType!&#x3D;”jpeg”:<br>               print(filename+”————“+imgType)<br>           # newName &#x3D; (filename + ‘.’ + imgType)<br>           # os.rename(filename,newName)<br>       else:<br>           i&#x3D;0<br>           # os.remove(filename)<br>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 提取图片信息到csv</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>   #读取文件中的标签名<br>   def xmlPath_list_to_df(xmlPath_list):<br>       xmlContent_list &#x3D; []<br>       for xmlPath in xmlPath_list:<br>           tree &#x3D; ET.parse(xmlPath)<br>           root &#x3D; tree.getroot()</p>
<pre><code>       for member in root.findall(&#39;object&#39;):
           # print(member[0].text)
           # print(member[0])
           if 1-(member[0].text in [&quot;windows&quot;,&quot;openingwindow&quot;,&quot;closedwindow&quot;]):
               continue
               # member[0].text = &quot;baby&quot; ,因为我们不需要baby了，乌龙，但是还有person
           if(member[0].text in [&quot;windows&quot;,&quot;openingwindow&quot;,&quot;closedwindow&quot;]):
               member[0].text=&quot;windows&quot;

           sam=root.find(&#39;filename&#39;).text
           result = (&#39;jpg&#39; in root.find(&#39;filename&#39;).text)
           if(1-result):
               sam=root.find(&#39;filename&#39;).text+&#39;.jpg&#39;

           value = (sam,
                    int(root.find(&#39;size&#39;)[0].text),
                    int(root.find(&#39;size&#39;)[1].text),
                    member[0].text,
                    int(member[4][0].text),
                    int(member[4][1].text),
                    int(member[4][2].text),
                    int(member[4][3].text)
                    )
           xmlContent_list.append(value)
   column_name = [&#39;filename&#39;, &#39;width&#39;, &#39;height&#39;, &#39;class&#39;, &#39;xmin&#39;, &#39;ymin&#39;, &#39;xmax&#39;, &#39;ymax&#39;]
   xmlContent_df = pd.DataFrame(xmlContent_list, columns=column_name)
   return xmlContent_df
</code></pre>
<p>   #保存地址<br>   def dirPath_to_csv(dirPath):<br>       fileName_list &#x3D; os.listdir(dirPath)<br>       all_xmlPath_list &#x3D; [os.path.join(dirPath, fileName) for fileName in fileName_list if ‘.xml’ in fileName]<br>       train_xmlPath_list, test_xmlPath_list &#x3D; train_test_split(all_xmlPath_list, test_size&#x3D;0.1, random_state&#x3D;1)<br>       train_df &#x3D; xmlPath_list_to_df(train_xmlPath_list)<br>       train_df.to_csv(‘train.csv’)<br>       print(‘成功产生文件train.csv,训练集共有%d张图片’ % len(train_xmlPath_list))<br>       test_df &#x3D; xmlPath_list_to_df(test_xmlPath_list)<br>       test_df.to_csv(‘test.csv’)<br>       print(‘成功产生文件test.csv,测试集共有%d张图片’ % len(test_xmlPath_list))</p>
<p>   #调用主函数<br>   dirPath_to_csv(‘imgs_xml’)<br>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 转化为record文件</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>   #读取函数<br>   def csv2tfrecord(csv_path, imageDir_path, tfrecord_path):<br>       objectInfo_df &#x3D; pd.read_csv(csv_path)<br>       tfrecord_writer &#x3D; tf.python_io.TFRecordWriter(tfrecord_path)<br>       for filename, group in objectInfo_df.groupby(‘filename’):<br>           height &#x3D; group.iloc[0][‘height’]<br>           width &#x3D; group.iloc[0][‘width’]<br>           filename_bytes &#x3D; filename.encode(‘utf-8’)<br>           image_path &#x3D; os.path.join(imageDir_path, filename)<br>           # print(image_path)<br>           with open(image_path, ‘rb’) as file:<br>               encoded_jpg &#x3D; file.read()<br>           image_format &#x3D; b’jpg’<br>           xmin_list &#x3D; list(group[‘xmin’] &#x2F; width)<br>           xmax_list &#x3D; list(group[‘xmax’] &#x2F; width)<br>           ymin_list &#x3D; list(group[‘ymin’] &#x2F; height)<br>           ymax_list &#x3D; list(group[‘ymax’] &#x2F; height)<br>           classText_list &#x3D; [classText.encode(‘utf-8’) for classText in group[‘class’]]<br>           classLabel_list &#x3D; [classText_to_classLabel(classText) for classText in group[‘class’]]<br>           tf_example &#x3D; tf.train.Example(<br>               features &#x3D; tf.train.Features(<br>                   feature &#x3D; {<br>                       ‘image&#x2F;height’: dataset_util.int64_feature(height),<br>                       ‘image&#x2F;width’: dataset_util.int64_feature(width),<br>                       ‘image&#x2F;filename’: dataset_util.bytes_feature(filename_bytes),<br>                       ‘image&#x2F;source_id’: dataset_util.bytes_feature(filename_bytes),<br>                       ‘image&#x2F;encoded’: dataset_util.bytes_feature(encoded_jpg),<br>                       ‘image&#x2F;format’: dataset_util.bytes_feature(image_format),<br>                       ‘image&#x2F;object&#x2F;bbox&#x2F;xmin’: dataset_util.float_list_feature(xmin_list),<br>                       ‘image&#x2F;object&#x2F;bbox&#x2F;xmax’: dataset_util.float_list_feature(xmax_list),<br>                       ‘image&#x2F;object&#x2F;bbox&#x2F;ymin’: dataset_util.float_list_feature(ymin_list),<br>                       ‘image&#x2F;object&#x2F;bbox&#x2F;ymax’: dataset_util.float_list_feature(ymax_list),<br>                       ‘image&#x2F;object&#x2F;class&#x2F;text’: dataset_util.bytes_list_feature(classText_list),<br>                       ‘image&#x2F;object&#x2F;class&#x2F;label’: dataset_util.int64_list_feature(classLabel_list),<br>                   }))<br>           tfrecord_writer.write(tf_example.SerializeToString())<br>       tfrecord_writer.close()<br>       print(‘成功产生tfrecord文件，保存在路径:%s’ %tfrecord_path)</p>
<p>   #目标检测的类别不同，需要修改此处<br>   def classText_to_classLabel(row_label):<br>       if row_label &#x3D;&#x3D; ‘windows’:<br>           return 1<br>       elif row_label &#x3D;&#x3D; ‘baby’:<br>           return 2<br>       else:<br>           return None</p>
<pre><code>   #保存地址
</code></pre>
<p>   dir_name &#x3D; ‘training’<br>   if not os.path.isdir(dir_name):<br>       os.mkdir(dir_name)<br>   csv2tfrecord(‘train.csv’, ‘imgs_xml’, ‘training&#x2F;train.tfrecord’)<br>   csv2tfrecord(‘test.csv’, ‘imgs_xml’, ‘training&#x2F;test.tfrecord’)<br>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   #### 训练</span><br><span class="line"></span><br><span class="line">5. 配置config文件：ssd_mobilenet_v2_coco.config（我们使用官方提供的这个模型，轻便所以很多人使用，对数据集不大的需求比较友好）。原代码太多，不做展示；主要修改如下：</span><br><span class="line"></span><br><span class="line">   - 配置自己的数据集地址</span><br><span class="line">   - 配置标签文件地址和标签数量</span><br><span class="line">   - 配置训练batch_size</span><br><span class="line">   - 配置模型保存时间</span><br><span class="line">   - 配置预训练模型</span><br><span class="line">   - 配置总训练步数</span><br><span class="line"></span><br><span class="line">6. 配置标签文件如下：</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>   item {<br>       name : ‘windows’<br>       id : 1<br>   }<br>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">7. 训练：</span><br><span class="line"></span><br><span class="line">   - 配置gpu环境：</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>   import os</p>
<h1 id="os-environ-‘CUDA-VISIBLE-DEVICES’-x3D-‘-x2F-device-GPU-0’-1"><a href="#os-environ-‘CUDA-VISIBLE-DEVICES’-x3D-‘-x2F-device-GPU-0’-1" class="headerlink" title="os.environ[‘CUDA_VISIBLE_DEVICES’] &#x3D; ‘&#x2F;device:GPU:0’"></a>os.environ[‘CUDA_VISIBLE_DEVICES’] &#x3D; ‘&#x2F;device:GPU:0’</h1><p>   os.environ[‘CUDA_VISIBLE_DEVICES’] &#x3D; “0”<br>   os.environ[“TF_FORCE_GPU_ALLOW_GROWTH”] &#x3D;”true”</p>
<h1 id="os-environ-“CUDA-VISIBLE-DEVICES”-x3D-“-1”-显然不行，直接要两百多秒了，用gpu只需要三十秒"><a href="#os-environ-“CUDA-VISIBLE-DEVICES”-x3D-“-1”-显然不行，直接要两百多秒了，用gpu只需要三十秒" class="headerlink" title="os.environ[“CUDA_VISIBLE_DEVICES”] &#x3D; “-1” # 显然不行，直接要两百多秒了，用gpu只需要三十秒"></a>os.environ[“CUDA_VISIBLE_DEVICES”] &#x3D; “-1” # 显然不行，直接要两百多秒了，用gpu只需要三十秒</h1><p>   os.environ[‘TF_CPP_MIN_LOG_LEVEL’] &#x3D; ‘3’</p>
<p>   &#96;&#96;&#96;</p>
<ul>
<li>运行官方main文件</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/04/%E7%BB%BC%E5%90%88%E8%AE%BE%E8%AE%A1/" data-id="cl2r8w6dx0004swvs3n56bxer" data-title="综合设计" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-综合设计成功" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/05/04/%E7%BB%BC%E5%90%88%E8%AE%BE%E8%AE%A1%E6%88%90%E5%8A%9F/" class="article-date">
  <time class="dt-published" datetime="2022-05-04T07:20:15.000Z" itemprop="datePublished">2022-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/05/04/%E7%BB%BC%E5%90%88%E8%AE%BE%E8%AE%A1%E6%88%90%E5%8A%9F/">综合设计成功</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>本文用于记录综合设计中成功的步骤，思路加步骤移步综合设计.md</p>
<h1 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h1><p>先自行安装VSC++和Ananconda</p>
<p>新建一个名为PYTHONPATH的环境变量：</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20220504125505736.png" alt="image-20220504125505736"></p>
<p>同时将上面三个路径复制到PATH里。</p>
<p>安装protoc：</p>
<ol>
<li>解压</li>
<li>将里面的bin添加到环境变量</li>
<li>使用<code>protoc --version</code>测试</li>
</ol>
<p>创建一个conda环境：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">conda info -e #查看当前系统有哪些python环境</span><br><span class="line"></span><br><span class="line">conda create -n tf-pose python=3.6</span><br><span class="line"></span><br><span class="line">activate tf-pose #激活环境</span><br><span class="line"></span><br><span class="line">pip install tensorflow==1.14</span><br><span class="line"></span><br><span class="line">pip install tensorflow-gpu==1.14</span><br><span class="line"></span><br><span class="line">#将object_detection/packages/tf1/setup.py复制到research目录下，后在research目录下执行</span><br><span class="line">protoc object_detection/protos/*.proto --python_out=.</span><br><span class="line">python -m pip install --use-feature=2020-resolver .</span><br><span class="line"></span><br><span class="line">#执行这行代码检验环境是否安装成功，ok则成功</span><br><span class="line">python object_detection/builders/model_builder_tf1_test.py</span><br></pre></td></tr></table></figure>

<p>cudnn：<a target="_blank" rel="noopener" href="https://developer.nvidia.com/rdp/cudnn-archive#a-collapse765-10">https://developer.nvidia.com/rdp/cudnn-archive#a-collapse765-10</a></p>
<p>cuda：<a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-toolkit-archive">https://developer.nvidia.com/cuda-toolkit-archive</a></p>
<p>cuda：10.0，cudnn：7.4 tensorflow：1.14</p>
<p>安装cuda的时候选择local，只选择这四个</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20220504125543190.png" alt="image-20220504125543190"></p>
<p>cudnn下载好后，将里面的三个文件夹复制到C盘里的cuda10.0的目录，完成</p>
<h1 id="准备数据集"><a href="#准备数据集" class="headerlink" title="准备数据集"></a>准备数据集</h1><p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3d9436b4cb66">https://www.jianshu.com/p/3d9436b4cb66</a></p>
<p>标注数据集：labelimg</p>
<p>使用的数据集：imagenet n04589890（窗）</p>
<p>ps:模型文件夹从train改为了train_my</p>
<ol>
<li><p>下载coco数据集：文件结构如下：（person_keypoints是人体结构的标注）</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210825220723003.png" alt="image-20210825220723003"></p>
</li>
<li><p>直接运行json_to_xml.py将coco数据集的instance.json提取出来，转换为xml文件</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210825223314606.png" alt="image-20210825223314606"></p>
</li>
<li><p>将train里的xml对应的图片拿出来和xml文件放在一起，然后和n04589890文件和放在imgs_xml文件夹中</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210826131223779.png" alt="image-20210826131223779"></p>
</li>
<li><p>运行xml_to_csv.py,获得test.csv和train.csv文件</p>
</li>
<li><p>运行csv_to_tfrecord.py文件，获得train_my文件夹，里面有训练测试两个tfrecord文件</p>
</li>
<li><p>将train_my文件夹和select文件夹复制到research目录下</p>
</li>
<li><p>在train_my文件夹中创建my_label_map.pbtxt文件编码无所谓，内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">item &#123;</span><br><span class="line">    name : &quot;window&quot;</span><br><span class="line">    id : 1</span><br><span class="line">&#125;</span><br><span class="line">item&#123;</span><br><span class="line">     name : &quot;person&quot;</span><br><span class="line">     id : 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将object_detection&#x2F;sample&#x2F;config目录下的ssd_mobilnet_v2_oid_v4.config复制到train_my目录下，并做如下修改</p>
<ul>
<li>第九行：num_classes修改为2（person和window）</li>
<li>第158行：”object_detection&#x2F;ssd_mobilenet_v2_oid_v4_2018_12_12&#x2F;model.ckpt”</li>
<li>第159行：steps修改为10000</li>
<li>第172行：input_path: “training_my&#x2F;train.tfrecord”</li>
<li>第174行：label_map_path: “training_my&#x2F;my_label_map.pbtxt”</li>
<li>第184行：input_path: “training_my&#x2F;test.tfrecord”</li>
<li>第186行：label_map_path: “training_my&#x2F;my_label_map.pbtxt”</li>
</ul>
</li>
<li><p>至此得到</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210825191808448.png" alt="image-20210825191808448"></p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210825191849162.png" alt="image-20210825191849162"></p>
<p>儿童和窗户数据集制作同上</p>
<h1 id="训练数据"><a href="#训练数据" class="headerlink" title="训练数据"></a>训练数据</h1><p>使用预训练模型：ssd-v2-oid_v4（git：<a target="_blank" rel="noopener" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf1_detection_zoo.md%EF%BC%89%E4%BF%9D%E5%AD%98%E5%88%B0object_detection%E7%9B%AE%E5%BD%95%E4%B8%8B">https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf1_detection_zoo.md）保存到object_detection目录下</a></p>
<ol>
<li><p>在research目录下运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#这是训练成年人的模型（一千万个steps）</span><br><span class="line">python object_detection/model_main.py --pipeline_config_path=training_my/ssd_mobilenet_v2_oid_v4.config --model_dir=training_my --sample_1_of_n_eval_examples=25 --alsologtostderr </span><br><span class="line"></span><br><span class="line">#这是训练儿童的模型（二十万）</span><br><span class="line">python object_detection/model_main.py --pipeline_config_path=training/ssdlite_mobilenet_v2_coco.config --model_dir=training  --alsologtostderr</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看模型训练情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensorboard --logdir=training_my</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://localhost:6006/%E6%9F%A5%E7%9C%8B">http://localhost:6006/查看</a></p>
</li>
</ol>
<p>训练好后得到的模型文件夹存放在train_my目录下</p>
<ol>
<li><p>导出模型（数字要对应config文件中的traing_my文件夹下最大的数字（最新））</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   #这是导出检测成年人的模型</span><br><span class="line">   python object_detection/export_inference_graph.py --input_type=image_tensor --pipeline_config_path=training_my/ssd_mobilenet_v2_oid_v4.config --trained_checkpoint_prefix=training_my/model.ckpt-53630 --output_directory=wb_inference_graph</span><br><span class="line"></span><br><span class="line">   #这是导出儿童的模型</span><br><span class="line">python object_detection/export_inference_graph.py --input_type=image_tensor --pipeline_config_path=training/ssdlite_mobilenet_v2_coco.config --trained_checkpoint_prefix=training/model.ckpt-16000 --output_directory=wb2_inference_graph</span><br></pre></td></tr></table></figure>

<p>会在research，目录下生成wb_inference_graph文件夹内容如下：</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog/image-20210825194418089.png" alt="image-20210825194418089"></p>
</li>
</ol>
<h1 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序"></a>运行程序</h1><p>将object_detection目录下的localthion.py中的如下代码修改位对应文件名</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210825194639612.png" alt="image-20210825194639612"></p>
<p>运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python object_detection/localtion.py</span><br></pre></td></tr></table></figure>

<p>这里注意一点，只需要将train文件夹里的my_label_map.pbtxt传到树莓派即可，不需要传整个train文件夹</p>
<p>然后官方的pbtxt在object_detection&#x2F;data目录下</p>
<p>收工</p>
<h1 id="结合树莓派"><a href="#结合树莓派" class="headerlink" title="结合树莓派"></a>结合树莓派</h1><h2 id="启动motion命令："><a href="#启动motion命令：" class="headerlink" title="启动motion命令："></a>启动motion命令：</h2><p>root权限下,&#x2F;home&#x2F;motion目录下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service motion start</span><br><span class="line">motion</span><br></pre></td></tr></table></figure>

<p>浏览器请求端口：8081</p>
<p>将test04.py上传到树莓派的object_detection目录下</p>
<p>python3运行test04.py，（注意里面的train目录，wb_目录，和网络摄像头的地址）（延迟大概有三十秒左右）</p>
<p>如果树莓派没有显示器，则不使用图形显示，只发信号，将如下代码</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210907191535871.png" alt="image-20210907191535871"></p>
<p>修改成：</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210907202234153.png" alt="image-20210907202234153"></p>
<p>对了树莓派上运行记得把这个注释掉</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog//image-20210825202627594.png" alt="image-20210825202627594"></p>
<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3d9436b4cb66">https://www.jianshu.com/p/3d9436b4cb66</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0e5f9df4686a">https://www.jianshu.com/p/0e5f9df4686a</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zlase/article/details/79261348">https://blog.csdn.net/zlase/article/details/79261348</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/61483632/e-tensorflow-stream-executor-cuda-cuda-driver-cc351-failed-call-to-cuinit-cuda">https://stackoverflow.com/questions/61483632/e-tensorflow-stream-executor-cuda-cuda-driver-cc351-failed-call-to-cuinit-cuda</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.csdn.net/topics/392851047">https://bbs.csdn.net/topics/392851047</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45709671/article/details/107448136">https://blog.csdn.net/weixin_45709671/article/details/107448136</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/csdnfala/article/details/91358622">https://blog.csdn.net/csdnfala/article/details/91358622</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2.md">https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2.md</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lscelory/article/details/83579062">https://blog.csdn.net/lscelory/article/details/83579062</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34289454/article/details/89611294">https://blog.csdn.net/weixin_34289454/article/details/89611294</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/63460911/why-do-i-keep-on-getting-no-module-named-official-error">https://stackoverflow.com/questions/63460911/why-do-i-keep-on-getting-no-module-named-official-error</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1qh411Y7uX?from=search&amp;seid=4131547032775557021">https://www.bilibili.com/video/BV1qh411Y7uX?from=search&amp;seid=4131547032775557021</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/68080345/importerror-cannot-import-name-layernormalization-from-tensorflow-python-ker">https://stackoverflow.com/questions/68080345/importerror-cannot-import-name-layernormalization-from-tensorflow-python-ker</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zong596568821xp/article/details/82015126">https://blog.csdn.net/zong596568821xp/article/details/82015126</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/67426245/unicodedecodeerror-utf-8-codec-cant-decode-byte-0xd5-in-position-93-invalid">https://stackoverflow.com/questions/67426245/unicodedecodeerror-utf-8-codec-cant-decode-byte-0xd5-in-position-93-invalid</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40493501/article/details/89787144%EF%BC%88%E6%97%A0%E8%A7%A3%E5%86%B3%EF%BC%89">https://blog.csdn.net/weixin_40493501/article/details/89787144（无解决）</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1tW411T7ei?p=2">https://www.bilibili.com/video/BV1tW411T7ei?p=2</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/04/%E7%BB%BC%E5%90%88%E8%AE%BE%E8%AE%A1%E6%88%90%E5%8A%9F/" data-id="cl2r96h900001k8vs6pw4bcin" data-title="综合设计成功" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-吴恩达机器学习" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/05/04/%E5%90%B4%E6%81%A9%E8%BE%BE%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time class="dt-published" datetime="2022-05-04T07:20:06.000Z" itemprop="datePublished">2022-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/05/04/%E5%90%B4%E6%81%A9%E8%BE%BE%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">吴恩达机器学习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="深度学习模型"><a href="#深度学习模型" class="headerlink" title="深度学习模型"></a>深度学习模型</h1><p>房价预测：standrad NN；图像预测：CNN；音频和语言翻译：RNN；</p>
<p>自动驾驶：image，Radar info更复制的神经网络结构</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210103170840250.png" alt="img"></p>
<p><strong>传统机器学习的弊端</strong></p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210103171237693.png" alt="传统学习方法弊端"></p>
<h2 id="二分类："><a href="#二分类：" class="headerlink" title="二分类："></a>二分类：</h2><p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210215113650842.png" alt="image-20210215113650842"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">三通道的图像，代表了3*像素点*像素点的图像数据，n_x = 3*64*64（64X64的图片）</span><br><span class="line">训练集的特征是一个n_x行，m列的矩阵</span><br><span class="line">标签是一个一行，m列的矩阵</span><br></pre></td></tr></table></figure>

<h2 id="logistic-回归："><a href="#logistic-回归：" class="headerlink" title="logistic 回归："></a>logistic 回归：</h2><p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210215121217431.png" alt="image-20210215121217431"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/04/%E5%90%B4%E6%81%A9%E8%BE%BE%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" data-id="cl2r8w6dt0001swvsb3s39i6p" data-title="吴恩达机器学习" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-爬虫" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/05/04/%E7%88%AC%E8%99%AB/" class="article-date">
  <time class="dt-published" datetime="2022-05-04T07:19:59.000Z" itemprop="datePublished">2022-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/05/04/%E7%88%AC%E8%99%AB/">爬虫</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="第一章：requests模块"><a href="#第一章：requests模块" class="headerlink" title="第一章：requests模块"></a>第一章：requests模块</h1><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>导入requests模块</li>
<li>指定url</li>
<li>UA伪装</li>
<li>参数params</li>
<li>response获取爬取结果</li>
<li>持久化存储（list_data &#x3D; response.text(json之类的)）</li>
</ol>
<p>ps：response.text和response.json()一个有括号一个没有括号</p>
<h1 id="第二章：数据解析"><a href="#第二章：数据解析" class="headerlink" title="第二章：数据解析"></a>第二章：数据解析</h1><h2 id="聚焦爬虫："><a href="#聚焦爬虫：" class="headerlink" title="聚焦爬虫："></a>聚焦爬虫：</h2><p>爬取页面中指定的内容。</p>
<p>编码流程：</p>
<ol>
<li>指定url</li>
<li>发起请求</li>
<li>获取相应数据</li>
<li>数据解析</li>
<li>持久化存储</li>
</ol>
<h2 id="数据解析分类"><a href="#数据解析分类" class="headerlink" title="数据解析分类"></a>数据解析分类</h2><ol>
<li><p>正则：ex &#x3D;(填div中的对应内容，使用（.<em>?）获取想得到的标签，或者标签里的属性，多余的数据用.</em>?省略)</p>
</li>
<li><p>bx4：实例化BeautifulSoup：(from bs4 import BeautifulSoup)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#将本地的html文档的数据加载到该对象中</span><br><span class="line">fp = open(&#x27;./test.html&#x27;,&#x27;r&#x27;,encoding =&#x27;utf-8&#x27;)</span><br><span class="line">soup = BeautifulSoup(fp,&#x27;lxml&#x27;)</span><br><span class="line">print(soup)</span><br><span class="line">#网页中的html对象</span><br><span class="line">page_text = response.text</span><br><span class="line">soup = BeautifulSoup(page_text,&#x27;lxml&#x27;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">soup.tagname  #返回该标签名第一次出现的那个标签</span><br><span class="line">soup.find(&#x27;div&#x27;，class_= &#x27;song&#x27;) #返回该属性的div</span><br><span class="line">soup.find_all(&#x27;a&#x27;)</span><br><span class="line"></span><br><span class="line">select(&#x27;某种选择器（id,class,标签。。。。选择器))，返回的是一个列表</span><br><span class="line">soup.select(&#x27;.tang&gt;ul&gt;li&gt;a&#x27;)[0] #拿到a标签列表中的第一个a标签</span><br><span class="line">soup.select(&#x27;.tang&gt;ul&gt; a&#x27;)[0] #空格表示多个层级</span><br><span class="line">soup.a.text/get_text/string #string只能获取该标签下的直系文本内容，text获取全部文本内容</span><br><span class="line">soup.a[&#x27;href&#x27;] # 获取标签中的属性值</span><br></pre></td></tr></table></figure>
</li>
<li><p>xpath（重点，通用性强）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.实例化一个etree对象，并且需要将被解析的页面源码数据加载到该对象中</span><br><span class="line">2.调用etree对象中的xpath种方法结合xpath表达式实现标签的定位和内容的捕获</span><br><span class="line">3.实例化对象：etree.parse(filepath)(本地)；etree.HTML（page_text）（网页）</span><br><span class="line">4.xpath（&#x27;xpath表达式&#x27;）：</span><br><span class="line">	r = tree.xpath(&#x27;/html/body/div&#x27;) #返回一个列表</span><br><span class="line">	r = tree.xpath(&#x27;/html//div&#x27;) #两个斜杠表示多个层级</span><br><span class="line">	r = tree.xpath(&#x27;//div[@class=&#x27;song&#x27;]/p[3]&#x27;) # 取出来p标签列表中的第四个元素</span><br><span class="line">	r = tree.xpath(&#x27;//div/[@class=&quot;tang&quot;]//li[5]/a/text()&#x27;)[0] #取出来一个标签返回的也是列表，所以加上索引0，表示第一个元素</span><br><span class="line">	/@attrName（/@src） #取属性值</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="数据解析原理"><a href="#数据解析原理" class="headerlink" title="数据解析原理"></a>数据解析原理</h2><ol>
<li>解析的局部文本内容都会在标签纸剑或者标签对应的属性中进行存储</li>
<li>进行指定标签的定位</li>
<li>标签或者标签对应的属性中所存储的数据值进行提取（解析）</li>
</ol>
<h1 id="第三章：反爬机制"><a href="#第三章：反爬机制" class="headerlink" title="第三章：反爬机制"></a>第三章：反爬机制</h1><h2 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h2><p>使用第三方识别验证码平台（超级鹰）,代码已经封装好了</p>
<p>chaojiying.PostPic(im,1902)返回的字典的第三个键值对的values为所需要的验证码值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chaojiying = Chaojiying_Client(&#x27;用户名&#x27;, &#x27;密码&#x27;, &#x27;912044&#x27;)  # 用户中心&gt;&gt;软件ID 生成一个替换 96001</span><br><span class="line">im = open(file_path, &#x27;rb&#x27;).read()  # 本地图片文件路径 来替换 a.jpg 有时WIN系统须要//</span><br><span class="line">print(list((chaojiying.PostPic(im, 1902)).values())[3])  # 1902 验证码类型  </span><br></pre></td></tr></table></figure>

<p>ps：验证是否登录成功：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">response = requests.post(url=url,headers=headers,data=data)</span><br><span class="line">print(response.status_code)</span><br><span class="line">#如果打印200，证明登录成功</span><br></pre></td></tr></table></figure>

<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><ol>
<li><p>来源：登录模拟的post请求后，有服务器端创建</p>
</li>
<li><p>session会话对象：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">作用：1.可以在请求的时候发送；2.如果请求过程产生了cookie会被自动存储到该session对象中</span><br><span class="line"></span><br><span class="line">exp：</span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    user_url = &#x27;https://www.chaojiying.com/user/login/&#x27;</span><br><span class="line">    data =&#123;</span><br><span class="line">        &#x27;user&#x27;: &#x27;winsfox&#x27;,</span><br><span class="line">        &#x27;pass&#x27;: &#x27;510623zmh&#x27;,</span><br><span class="line">        &#x27;imgtxt&#x27;:result,</span><br><span class="line">        &#x27;act&#x27;: &#x27;1&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    #（2）使用session进行post发送</span><br><span class="line">    response = session.post(url=user_url,headers=headers,data=data)</span><br><span class="line">    print(response.status_code)</span><br><span class="line">    detail_url = &#x27;https://www.chaojiying.com/user/&#x27;</span><br><span class="line"></span><br><span class="line">    detail_page_text = session.get(url=detail_url,headers=headers).text</span><br><span class="line">    with open(&#x27;my chaojiying.html&#x27;,&#x27;w&#x27;,encoding=&#x27;utf-8&#x27;) as fp:</span><br><span class="line">        fp.write(detail_page_text)</span><br></pre></td></tr></table></figure>

<h2 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h2></li>
</ol>
<p>破解封IP这种反爬机制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">——代理服务器。</span><br><span class="line">代理的作用：</span><br><span class="line">		———突破IP访问的限制</span><br><span class="line">		———隐藏自身真实IP</span><br><span class="line">代理相关网站：</span><br><span class="line">		———快代理</span><br><span class="line">		———西祠代理</span><br><span class="line">		———www.goubanjia.com</span><br><span class="line">代理IP的类型：</span><br><span class="line">		——https；http</span><br><span class="line">代理IP的匿名的：</span><br><span class="line">		——透明：服务器知道该次请求使用了代理；也知道真实的Ip</span><br><span class="line">		——匿名：知道使用了代理，但不知道真实的Ip</span><br><span class="line">		——高匿：不知道使用了代理更不知道本机的真实Ip（遇到封IP的反扒机制需要用这个）</span><br></pre></td></tr></table></figure>

<p>ps:一个网站登录上后，再用爬虫爬的时候可能找不到验证码的位置</p>
<h1 id="PS"><a href="#PS" class="headerlink" title="PS:"></a>PS:</h1><ol>
<li>有时候拿到的src不全，需要进行字符串拼接</li>
<li>div的class中有些无法获取，如：<img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210122232346354.png" alt="image-20210122232346354"></li>
<li>在使用etree.xpath()的时候需要删去，如</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a_list = tree.xpath(&#x27;//div[@class=&quot;box col3 ws_block&quot;]&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="第四章：高性能异步爬虫"><a href="#第四章：高性能异步爬虫" class="headerlink" title="第四章：高性能异步爬虫"></a>第四章：高性能异步爬虫</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">原因：发送请求会有延时，导致阻塞，后面的url请求</span><br><span class="line">	方式1：多线程（不建议使用，耗费cpu资源）</span><br><span class="line">	方式2：线程池（效率不明显，适当使用）</span><br><span class="line">	方法3：单线程+异步协程（推荐）</span><br></pre></td></tr></table></figure>

<p>PS：在text中找不到元素就是通过ajax加载的，要用抓包工具找</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requests.get()发起的请求是基于同步的，不能用在异步协程中，必须使用基于异步的网络请求的模块：aiohttp</span><br></pre></td></tr></table></figure>

<h1 id="第五章：动态加载数据处理"><a href="#第五章：动态加载数据处理" class="headerlink" title="第五章：动态加载数据处理"></a>第五章：动态加载数据处理</h1><h2 id="模拟浏览器操作：selenium"><a href="#模拟浏览器操作：selenium" class="headerlink" title="模拟浏览器操作：selenium"></a>模拟浏览器操作：selenium</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">selenium模块</span><br><span class="line">	-便捷的获取网站中的动态加载数据</span><br><span class="line">	-便捷的实现模拟登陆</span><br><span class="line">	-基于浏览器自动化的一个模块</span><br><span class="line">步骤：</span><br><span class="line">	——pip install selenium</span><br><span class="line">	——下载对应浏览器版本的驱动程序</span><br><span class="line">	——实例化一个浏览器对象</span><br><span class="line">	——编写基于浏览器自动化的操作代码</span><br><span class="line">相关函数：</span><br><span class="line">	bro.get(url)</span><br><span class="line">	search_input = bro.find_element_by_id(&#x27;q&#x27;) # 根据id查找元素（其他的选择器也行）</span><br><span class="line">	bro.execute_script(&#x27;widnow.scrollTo(0,document.body.scrollHeight)&#x27;) #执行js程序</span><br><span class="line">	botton = (找到的一个input元素)；botton.click()</span><br><span class="line">	bro.back() #回退上一个页面；forward</span><br><span class="line">	bro.quit()</span><br><span class="line">	send_keys(字符串) #标签交互</span><br><span class="line">selenlium处理iframe:</span><br><span class="line">	如果定位的标签存在与iframe标签中，必须使用switch_to.frame(id)</span><br><span class="line">	动作链（拖动）：from selenium。webdriver import ActionChains</span><br><span class="line">		实例化一个动作链对象：action = ActionChains（bro）</span><br><span class="line">		click_and_hold(div):长按且点击操作</span><br><span class="line">		move_by_offset(x,y)</span><br><span class="line">		perform()让动作链立即执行</span><br><span class="line">		action.release()释放动作链对象</span><br></pre></td></tr></table></figure>

<h3 id="无头浏览器-反检测："><a href="#无头浏览器-反检测：" class="headerlink" title="无头浏览器-反检测："></a>无头浏览器-反检测：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">from time import sleep</span><br><span class="line">#实现无可视化界面的操作</span><br><span class="line">from selenium.webdriver.chrome.options import Options</span><br><span class="line">#实现规避操作</span><br><span class="line">from selenium.webdriver import ChromeOptions</span><br><span class="line"></span><br><span class="line">#实现无可视化界面</span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_argument(&#x27;--headless&#x27;)</span><br><span class="line">chrome_options.add_argument(&#x27;--disable-gpu&#x27;)</span><br><span class="line"></span><br><span class="line">#实现检测规避</span><br><span class="line">option = ChromeOptions()</span><br><span class="line">option.add_experimental_option(&#x27;excludeSwitches&#x27;,[&#x27;enable-automation&#x27;])</span><br><span class="line"></span><br><span class="line">bro = webdriver.Chrome(executable_path=&#x27;./chromedriver.exe&#x27;,chrome_options=chrome_options,options=option)</span><br><span class="line"></span><br><span class="line">#无可视化界面</span><br><span class="line">bro.get(&#x27;https://www.baidu.com&#x27;)</span><br><span class="line">print(bro.page_source)</span><br><span class="line">sleep(2)</span><br><span class="line">bro.quit()</span><br><span class="line">其中使用的是bro.page_source返回页面详情数据</span><br></pre></td></tr></table></figure>

<h3 id="点击式验证码："><a href="#点击式验证码：" class="headerlink" title="点击式验证码："></a>点击式验证码：</h3><p>参看源码-&gt;自制-&gt;pachong-&gt;第五章：动态加载数据处理-&gt;识别验证码(完成).py</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/04/%E7%88%AC%E8%99%AB/" data-id="cl2r8w6dz0005swvs049t92y2" data-title="爬虫" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-阿里云" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/05/04/%E9%98%BF%E9%87%8C%E4%BA%91/" class="article-date">
  <time class="dt-published" datetime="2022-05-04T07:19:49.000Z" itemprop="datePublished">2022-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/05/04/%E9%98%BF%E9%87%8C%E4%BA%91/">阿里云</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="弹性计算"><a href="#弹性计算" class="headerlink" title="弹性计算"></a>弹性计算</h1><h1 id="购买服务器"><a href="#购买服务器" class="headerlink" title="购买服务器"></a>购买服务器</h1><p>云服务实例ECS</p>
<h1 id="设置实例密码："><a href="#设置实例密码：" class="headerlink" title="设置实例密码："></a>设置实例密码：</h1><p>购买完服务器之后，在工作台——云服务实例打开后台界面</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812164352177.png" alt="image-20210812164352177"></p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812164514401.png" alt="image-20210812164514401"></p>
<p>实例界面</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812164646268.png" alt="image-20210812164646268"></p>
<h1 id="设置安全组合安全规则"><a href="#设置安全组合安全规则" class="headerlink" title="设置安全组合安全规则"></a>设置安全组合安全规则</h1><h2 id="端口放行"><a href="#端口放行" class="headerlink" title="端口放行"></a>端口放行</h2><p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812165503176.png" alt="image-20210812165503176"></p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812165650050.png" alt="image-20210812165650050"></p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812165907370.png" alt="image-20210812165907370"></p>
<p>服务器向外访问都是放行的</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812170033323.png" alt="image-20210812170033323"></p>
<h2 id="安全组特点"><a href="#安全组特点" class="headerlink" title="安全组特点"></a>安全组特点</h2><ul>
<li>一台ECS实例至少有一个安全组，可以同时有多个</li>
<li>一个安全组可以管理一个地域内的多台ECS实例，这些实例要求具有相同安全保护需求并相互信任</li>
<li>在没有设置允许访问的安全组规则的情况下，不同的安全组的ecs实例默认内网不通</li>
<li>同一安全组内的ECS实例之间可以实现内网互通</li>
<li>（仅普通安全组）可以通过安全组规则授权两个安全组之间互访</li>
<li>安全组支持状态应用，一个有状态的会话连接中，会话最长的保持时间是910秒，安全组会默认放行同一通话中的通信，例如，在会话期间内，如果连接的数据包在入方向是允许的，则在出方向也是允许的</li>
</ul>
<h2 id="创建安全组"><a href="#创建安全组" class="headerlink" title="创建安全组"></a>创建安全组</h2><p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812170256465.png" alt="image-20210812170256465"></p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812171123529.png" alt="image-20210812171123529"></p>
<p>绑定安全组到实例</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812171226819.png" alt="image-20210812171226819"></p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812171258885.png" alt="image-20210812171258885"></p>
<h1 id="Xshell和Xftp安装和使用"><a href="#Xshell和Xftp安装和使用" class="headerlink" title="Xshell和Xftp安装和使用"></a>Xshell和Xftp安装和使用</h1><h1 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h1><h2 id="安装JDK"><a href="#安装JDK" class="headerlink" title="安装JDK"></a>安装JDK</h2><ol>
<li><p>解压JDK到<code>/usr/java</code>目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk-9.0.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加到环境变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#在最后一行set java environment</span><br><span class="line">JAVA_HOME=/usr/java/jdk-9.0.1</span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib.tools.jar</span><br><span class="line">PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">export JAVA_HOME CLASSPATH PATH</span><br><span class="line"></span><br><span class="line">#保存退出</span><br></pre></td></tr></table></figure>
</li>
<li><p>生效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br><span class="line"># 检查</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>

<p>Tomcat</p>
</li>
</ol>
<hr>
<ol>
<li><p>进入到&#x2F;home&#x2F;soft,将Tomcat解压到&#x2F;usr&#x2F;local</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf tomcat -C /usr/local</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入tomcat目录，启动start.sh文件</p>
</li>
<li><p>在公网上访问服务器IP的8080端口，进入Tomcat主页</p>
</li>
</ol>
<h2 id="安装数据库（MariaDB）"><a href="#安装数据库（MariaDB）" class="headerlink" title="安装数据库（MariaDB）"></a>安装数据库（MariaDB）</h2><p>官网：<a target="_blank" rel="noopener" href="https://downloads.mariadb.org/mariadb/repositories/">https://downloads.mariadb.org/mariadb/repositories/</a></p>
<p><strong>使用MariaDB代替mysql数据库（MariaDB数据库管理系统是MySQL的一个分支，主要由开源社区在维护，采用GPL授权许可。开发这个分支的原因之一是：甲骨文公司收购了MySQL后，有将MySQL闭源的潜在风险，因此社区采用分支的方式来避开这个风险。</strong></p>
<p>1.首先确定centos版本</p>
<p>cat &#x2F;etc&#x2F;redhat-release</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/1247170-20200422103217076-433323331.png" alt="img"></p>
<p>2.yum安装</p>
<p>yum -y install mariadb-server</p>
<p>3.启动服务</p>
<p>systemctl start mariadb.service</p>
<p>4.开机自动启动</p>
<p>systemctl enable mariadb.service</p>
<p>5.修改密码</p>
<p>mysqladmin -u root password ‘123456’或者</p>
<p>&#x2F;usr&#x2F;bin&#x2F;mysqladmin -u root password ‘123456’</p>
<p>6.登录</p>
<p>mysql -uroot -p123456</p>
<p>【修改mysql(yum安装)字符集及端口号】</p>
<p>登录进入mysql后 查看字符集</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/1247170-20200422103709793-115390543.png" alt="img"></p>
<p>8.更改字符集及端口</p>
<p>vim &#x2F;etc&#x2F;my.cnf</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/1247170-20200422103824762-1611462059.png" alt="img"></p>
<p>9.重新启动mysql</p>
<p>systemctl restart mariadb.service 或者 systemctl restart mariadb</p>
<p>如果无法重启 可以通过 ps -ef | grep mysql 查找进程号 然后kill掉 再重启</p>
<p>10.再次登录mysql 查看字符集</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/1247170-20200422104107030-1736300756.png" alt="img"></p>
<p>11 修改数据库字符集成功后 navicat连接数据库</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/1247170-20200422104606682-2039274759.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/1247170-20200422104621635-655108759.png" alt="img"></p>
<p>连接过程遇到问题，百度了下解决方案，客户端连接报错</p>
<p>这个问题是因为用户在数据库服务器中的mysql数据库中的user的表中没有权限</p>
<p>（1）下面是解决客户端连接不上的问题</p>
<p>连接服务器 mysql -u root -p</p>
<p>输入密码进入数据库</p>
<p>（2）</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/1247170-20200422104901825-586473901.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/1247170-20200422105004987-154840583.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/1247170-20200422104959930-2127014322.png" alt="img"></p>
<p>（3） <strong>查看user表中的数据：select Host, User,Password from user;</strong></p>
<p><strong>（4）上面localhost表示只允许本地连接 不能远程连接</strong></p>
<p><strong>修改user表中的host</strong></p>
<p><strong>update user set Host&#x3D;’%’ where User&#x3D;’root’ and Host&#x3D;”localhost”;</strong></p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/1247170-20200422105809411-1554988867.png" alt="img"></p>
<p>（5）重新navicate连接数据库客户端</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/1247170-20200422105924947-1584919177.png" alt="img"></p>
<p>【遇到一个问题】</p>
<p>Linux本地看不到完整的表</p>
<p>【解决方案】</p>
<p>ps -ef | grep mysql</p>
<p>systemctl stop mariadb</p>
<p>停掉mysql应用，加入配置</p>
<p>mysqld_safe –skip-grant-tables，或者vi &#x2F;etc&#x2F;my.cnf，在[mysqld]段中加入 skip-grant-tables</p>
<p>select * from user;</p>
<p>delete from user where host&#x3D;’localhost’;</p>
<p>INSERT INTO <code>user</code> VALUES (‘localhost’,’root’,’’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’Y’,’’,’’,’’,’’,’0’,’0’,’0’,’0’,’’,’’);</p>
<h2 id="安装fastDFS和Nginx"><a href="#安装fastDFS和Nginx" class="headerlink" title="安装fastDFS和Nginx"></a>安装fastDFS和Nginx</h2><h2 id="配置Nginx的config文件"><a href="#配置Nginx的config文件" class="headerlink" title="配置Nginx的config文件"></a>配置Nginx的config文件</h2><ol>
<li>配置配置文件</li>
</ol>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812193406362.png" alt="image-20210812193406362"></p>
<ol>
<li>启动Nginx</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s reload</span><br></pre></td></tr></table></figure>

<ol>
<li>关闭安全组里的8080端口</li>
</ol>
<h1 id="前后端分别打包"><a href="#前后端分别打包" class="headerlink" title="前后端分别打包"></a>前后端分别打包</h1><p>这里没有前端</p>
<ol>
<li><p>IDea后端打包，使用的原生的tomcat，需要将spring中内置的tomcat移出再打包</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812195543979.png" alt="image-20210812195543979"></p>
</li>
<li><p>打包插件</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812195427045.png" alt="image-20210812195427045"></p>
</li>
<li><p>使用一个类来启动Application</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210812195331313.png" alt="image-20210812195331313"></p>
<ol start="5">
<li>maven-项目名-clean-install（得到war包）</li>
</ol>
<h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><h2 id="将war包上传到Tomcat"><a href="#将war包上传到Tomcat" class="headerlink" title="将war包上传到Tomcat"></a>将war包上传到Tomcat</h2><ol>
<li>先停止tomcat</li>
<li>上传到webapps目录下</li>
<li>在bin下启动start.sh（启动tomcat自动解压webapps）</li>
</ol>
<h1 id="x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-分割线-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D"><a href="#x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-分割线-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;分割线&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;"></a>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;分割线&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</h1><h2 id="linux目录"><a href="#linux目录" class="headerlink" title="linux目录"></a>linux目录</h2><p>1、bin，这个文件夹存放的是普通用户使用的命令。如下图中我们都熟悉的yum zip mkdir……，与之对应的是sbin,存放的是管理员使用的命令。</p>
<p>2、boot 这个目录中存放的是系统启动相关的文件，例如grub(引导安装的程序)</p>
<p>3、dev 这个文件中存放的是一些计算机设备文件</p>
<p>4、etc 这个目录中存放的是一些配置文件，如配置网络信息了，用户信息等（如图中network就存放着网络相关的配置信息。）。</p>
<p>5、home 这各目录是用来存放，非root用户的家目录的，也就是你在登录普通用户后主机名后是“~”时所在的目录。</p>
<p>6、root目录是root用户家目录的。</p>
<p>7、run 是用来存放各种运行的数据，是运行中进程产生的文件。</p>
<p>8、tmp,这个文件是用来存放临时文件的，进程产生的文件。</p>
<p><strong>9、usr存放系统文件，相当于windows 的C:&#x2F;windows 文件。</strong></p>
<p>10、var存放的是一写变化的文件，如日志、数据库等</p>
<h1 id="tips："><a href="#tips：" class="headerlink" title="tips："></a>tips：</h1><p>accesskey入口：</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20210925212042402.png" alt="image-20210925212042402"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/04/%E9%98%BF%E9%87%8C%E4%BA%91/" data-id="cl2r96h920002k8vs3u6j5llv" data-title="阿里云" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Typora-PicGo" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/05/04/Typora-PicGo/" class="article-date">
  <time class="dt-published" datetime="2022-05-04T07:19:37.000Z" itemprop="datePublished">2022-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/05/04/Typora-PicGo/">Typora+PicGo</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近gitee上的图片要验证了，浏览器上没授权访问不了，还是用回github</p>
<h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><p><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/picgo/releases">https://github.com/Molunerfinn/picgo/releases</a></p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>这里只介绍Github配置：</p>
<ol>
<li>登录自己的github，点击头像，点击settings</li>
<li>点击Developer Settings，点击Personal access tokens</li>
<li>点击Generate new token</li>
<li>权限第一个大项全选</li>
<li>设置永不过期</li>
<li>完成，复制token（它永远不会再次显示，你要自己记在自己的密码本上）</li>
<li>新建一个仓库，创建一个文件夹</li>
</ol>
<p>PicGo配置：</p>
<ol>
<li>安装完成后运行，点击图床设置，github图床</li>
<li>仓库名就是github名&#x2F;刚刚的仓库名</li>
<li>token就是刚复制的</li>
<li>指定路径，就是文件夹&#x2F;</li>
<li>自定义域名：<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/windsfox/blog_img/master">https://raw.githubusercontent.com/windsfox/blog_img/master</a></li>
</ol>
<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><h2 id="success：false"><a href="#success：false" class="headerlink" title="success：false"></a>success：false</h2><p>这种情况一般是，之前上传的时候，图片已经传上去了，但是没有得到网络路径。 解决方案：你需要自己用替换功能，将图片那里的本地文件夹替换成上面说的自定义域名</p>
<h2 id="fail-to-fetch"><a href="#fail-to-fetch" class="headerlink" title="fail to fetch"></a>fail to fetch</h2><p>这种情况是说，本地端口出现了问题 原因：你使用Typora会话框一起上传文件，会导致多个PicGo.exe进程同时占用原本的端口（36677）。有的就会开辟另外的端口（366771）但这就超出了本地端口地址的范围（65535） 解决方案：将所有上传进程关闭，打开客户端，点击PicGo设置，点击设置Server，将端口号设置为36677。然后重新一个一个上传</p>
<h1 id="gitee"><a href="#gitee" class="headerlink" title="gitee"></a>gitee</h1><p>因为github上的图片有时候会被墙，所以现在改用gitee（插件需要nodejs）</p>
<ol>
<li>下载插件：<img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/664e2152df89e60dec2f3b58e165f7b0.png" alt="image.png"></li>
<li>设置拉到最下面里选择将gitee打开</li>
<li>图床设置里，打开gitee<img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/f9a9c7f5331a698c40251dfc0fe1e1e3.png" alt="image.png"></li>
<li>设置为默认图床</li>
</ol>
<p><strong>文章作者：</strong><a target="_blank" rel="noopener" href="https://www.windsfox.top/"> windsfox</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/04/Typora-PicGo/" data-id="cl2r96h8x0000k8vshp149flq" data-title="Typora+PicGo" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-RabbitMq" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/05/04/RabbitMq/" class="article-date">
  <time class="dt-published" datetime="2022-05-04T07:19:20.000Z" itemprop="datePublished">2022-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/05/04/RabbitMq/">RabbitMq</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>我们需要将rabbitmq 和 erlang 安装包提前准备好(注意二者版本)</p>
<ol>
<li>ribbitmq: <a target="_blank" rel="noopener" href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a></li>
<li>Erlang: <a target="_blank" rel="noopener" href="https://www.rabbitmq.com/which-erlang.html">https://www.rabbitmq.com/which-erlang.html</a></li>
</ol>
<p>安装包：<br>创建一个目录<br><code>mkdir -p /usr/rabbitmq</code><br><img src="https://gitee.com/gitzuo/blog2021/raw/master/blog2022/202205041251558.png" alt="ce989b0ee3c0d863f68b24c30c1df172.png"></p>
<h2 id="解压-erlang-语言包"><a href="#解压-erlang-语言包" class="headerlink" title="解压 erlang 语言包"></a>解压 erlang 语言包</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh erlang-solutions-2.0-1.noarch.rpm`</span><br><span class="line">解压完毕，开始安装 erlang</span><br><span class="line">`yum install -y erlang`</span><br><span class="line">安装需要等待一点时间，安装完毕后，检测erlang版本，出现版本号表示安装成</span><br><span class="line">`erl -v</span><br></pre></td></tr></table></figure>

<h2 id="安装socat"><a href="#安装socat" class="headerlink" title="安装socat"></a>安装socat</h2><p>rabbitmq 在安装过程中需要依赖这个插件，需要先安装<br><code>yum install -y socat</code></p>
<p><img src="https://gitee.com/gitzuo/blog2021/raw/master/blog2022/a751df878b7938c69cd9e4457e696b14.png" alt="a751df878b7938c69cd9e4457e696b14.png"></p>
<h2 id="安装rabbitmq"><a href="#安装rabbitmq" class="headerlink" title="安装rabbitmq"></a>安装rabbitmq</h2><p>解压 rabbitmq 安装包，注意实际的包名要以我们自己下载的包名<br><code>rpm -Uvh rabbitmq-server-3.8.13-1.el8.noarch.rpm</code><br>解压完毕，开始安装<br><code>yum install rabbitmq-server -y</code><br>安装完毕，启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 启动服务</span><br><span class="line">systemctl start rabbitmq-server</span><br><span class="line"># 查看服务状态，running表示启动成功</span><br><span class="line">systemctl status rabbitmq-server.service</span><br><span class="line"># 开机自启动</span><br><span class="line">systemctl enable rabbitmq-server</span><br><span class="line"># 停止服务</span><br><span class="line">systemctl stop rabbitmq-server</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/gitzuo/blog2021/raw/master/blog2022/b8a152744c311cd3f44e0cc8fa55556c.png" alt="b8a152744c311cd3f44e0cc8fa55556c.png"></p>
<h1 id="RabbitMQWeb管理界面及授权操作"><a href="#RabbitMQWeb管理界面及授权操作" class="headerlink" title="RabbitMQWeb管理界面及授权操作"></a>RabbitMQWeb管理界面及授权操作</h1><h2 id="RabbitMQ管理界面"><a href="#RabbitMQ管理界面" class="headerlink" title="RabbitMQ管理界面"></a>RabbitMQ管理界面</h2><p>默认情况下，是没有安装web端的客户端插件，需要安装才可以生效</p>
<p>执行命令，开始安装rabbitmq管理界面插件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>

<p>安装完毕以后，重启服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart rabbitmq-server</span><br></pre></td></tr></table></figure>

<p>访问浏览器，访问地址：服务器 IP+端口号（默认15672）</p>
<p><img src="https://gitee.com/gitzuo/blog2021/raw/master/blog2022/5ea3426e9d7b969945030c970763e1bd.png" alt="5ea3426e9d7b969945030c970763e1bd.png"></p>
<p>注意：</p>
<ol>
<li>记得服务器开端口</li>
<li>guest只是localhost的密码和账号，还需要创建一个可供客户端访问的账号</li>
</ol>
<h2 id="授权账号和密码"><a href="#授权账号和密码" class="headerlink" title="授权账号和密码"></a>授权账号和密码</h2><p>新增用户，账号 admin，密码 admin</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl add_user admin admin</span><br></pre></td></tr></table></figure>

<p>设置用户分配操作权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl set_user_tags admin administrator</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog/image-20211111231100328.png" alt="image-20211111231100328"></p>
<p>设置用户分配操作权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl set_user_tags admin administrator</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog/image-20211111232209875.png" alt="image-20211111232209875"></p>
<p>用户操作权限分四种级别：</p>
<p>administrator：可以登录控制台、查看所有信息、可以对 rabbitmq进行管理<br>monitoring：监控者 登录控制台，查看所有信息<br>policymaker：策略制定者 登录控制台，指定策略<br>managment 普通管理员 登录控制台<br>为用户添加资源权限（授予访问虚拟机根节点的所有资源，如果已经选择了admin，那么这个命令可以不执行）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl set_permissions -p / admin &quot;.*&quot;&quot;.*&quot;&quot;.*&quot;</span><br></pre></td></tr></table></figure>

<p>网页登录成功</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog/image-20211111232355291.png" alt="image-20211111232355291"></p>
<p>参考：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_47257749/article/details/116400508?spm=1001.2101.3001.6650.10&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-10.no_search_link&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-10.no_search_link">https://blog.csdn.net/weixin_47257749&#x2F;article&#x2F;details&#x2F;116400508?spm&#x3D;1001.2101.3001.6650.10&amp;utm_medium&#x3D;distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-10.no_search_link&amp;depth_1-utm_source&#x3D;distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-10.no_search_link</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/04/RabbitMq/" data-id="cl2r8w6dp0000swvsacft81oc" data-title="RabbitMq" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hexo搭建博客" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/05/04/hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" class="article-date">
  <time class="dt-published" datetime="2022-05-04T07:18:52.000Z" itemprop="datePublished">2022-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/05/04/hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/">hexo搭建博客</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><p>1，所有命令都必须在主目录下完成</p>
<p>2，文章必须由</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo n <span class="string">&quot;文章名&quot;</span></span><br></pre></td></tr></table></figure>

<p>创建，不能复制文件。</p>
<p>3， 文章中不能有一下符号</p>
<p><img src="https://raw.githubusercontent.com/windsfox/blog_img/master/blog2022/image-20220504153744856.png" alt="image-20220504153744856"></p>
<p>最好用空格分开：{ {内容} }</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/04/hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" data-id="cl2r8w6dw0003swvs95vubs5h" data-title="hexo搭建博客" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/05/04/hello-world/" class="article-date">
  <time class="dt-published" datetime="2022-05-04T04:45:08.348Z" itemprop="datePublished">2022-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/05/04/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/04/hello-world/" data-id="cl2r8rrbm0000e8vs1k3o421w" data-title="Hello World" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/05/04/%E7%BB%BC%E5%90%88%E8%AE%BE%E8%AE%A1/">综合设计</a>
          </li>
        
          <li>
            <a href="/2022/05/04/%E7%BB%BC%E5%90%88%E8%AE%BE%E8%AE%A1%E6%88%90%E5%8A%9F/">综合设计成功</a>
          </li>
        
          <li>
            <a href="/2022/05/04/%E5%90%B4%E6%81%A9%E8%BE%BE%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">吴恩达机器学习</a>
          </li>
        
          <li>
            <a href="/2022/05/04/%E7%88%AC%E8%99%AB/">爬虫</a>
          </li>
        
          <li>
            <a href="/2022/05/04/%E9%98%BF%E9%87%8C%E4%BA%91/">阿里云</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>